<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=en xml:lang=en><meta charset=utf-8><meta name=generator content="quarto-1.7.33"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes"><title>w15 – Operating System (2025 Fall)</title><style>code{white-space:pre-wrap}span.smallcaps{font-variant:small-caps}div.columns{display:flex;gap:min(4vw,1.5em)}div.column{flex:auto;overflow-x:auto}div.hanging-indent{margin-left:1.5em;text-indent:-1.5em}ul.task-list{list-style:none}ul.task-list li input[type=checkbox]{width:.8em;margin:0 .8em .2em -1em;vertical-align:middle}html{-webkit-text-size-adjust:100%}pre>code.sourceCode{white-space:pre;position:relative}pre>code.sourceCode>span{display:inline-block;line-height:1.25}pre>code.sourceCode>span:empty{height:1.2em}.sourceCode{overflow:visible}code.sourceCode>span{color:inherit;text-decoration:inherit}div.sourceCode{margin:1em 0}pre.sourceCode{margin:0}@media screen{div.sourceCode{overflow:auto}}@media print{pre>code.sourceCode{white-space:pre-wrap}pre>code.sourceCode>span{text-indent:-5em;padding-left:5em}}pre.numberSource code{counter-reset:source-line 0}pre.numberSource code>span{position:relative;left:-4em;counter-increment:source-line}pre.numberSource code>span>a:first-child::before{content:counter(source-line);position:relative;left:-1em;text-align:right;vertical-align:baseline;border:none;display:inline-block;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;padding:0 4px;width:4em}pre.numberSource{margin-left:3em;padding-left:4px}div.sourceCode{}@media screen{pre>code.sourceCode>span>a:first-child::before{text-decoration:underline}}</style><script src=../site_libs/quarto-nav/quarto-nav.js></script><script src=../site_libs/clipboard/clipboard.min.js></script><script src=../site_libs/quarto-search/autocomplete.umd.js></script><script src=../site_libs/quarto-search/fuse.min.js></script><script src=../site_libs/quarto-search/quarto-search.js></script><meta name=quarto:offset content="../"><link href=../images/orange.png rel=icon type=image/png><script src=../site_libs/quarto-html/quarto.js type=module></script><script src=../site_libs/quarto-html/tabsets/tabsets.js type=module></script><script src=../site_libs/quarto-html/popper.min.js></script><script src=../site_libs/quarto-html/tippy.umd.min.js></script><script src=../site_libs/quarto-html/anchor.min.js></script><link href=../site_libs/quarto-html/tippy.css rel=stylesheet><link href=../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css rel=stylesheet id=quarto-text-highlighting-styles><script src=../site_libs/bootstrap/bootstrap.min.js></script><link href=../site_libs/bootstrap/bootstrap-icons.css rel=stylesheet><link href=../site_libs/bootstrap/bootstrap-a3d6f4078ec9f2632a80ad631344d584.min.css rel=stylesheet append-hash=true id=quarto-bootstrap data-mode=light><script id=quarto-search-options type=application/json>{"location":"navbar","copy-button":false,"collapse-after":3,"panel-placement":"end","type":"overlay","limit":50,"keyboard-shortcut":["f","/","s"],"show-item-context":false,"language":{"search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search"}}</script><body class="nav-sidebar docked nav-fixed quarto-light"><div id=quarto-search-results></div><header id=quarto-header class="headroom fixed-top"><nav class="navbar navbar-expand-lg" data-bs-theme=dark><div class="navbar-container container-fluid"><div class="navbar-brand-container mx-auto"><a class=navbar-brand href=../index.html><span class=navbar-title>Operating System (2025 Fall)</span></a></div><div id=quarto-search title=Search></div><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarCollapse aria-controls=navbarCollapse role=menu aria-expanded=false aria-label="Toggle navigation" onclick=window.quartoToggleHeadroom&&window.quartoToggleHeadroom()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarCollapse><ul class="navbar-nav navbar-nav-scroll me-auto"><li class=nav-item><a class="nav-link active" href=../index.html aria-current=page><span class=menu-text>Home</span></a><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=nav-menu-handouts role=link data-bs-toggle=dropdown aria-expanded=false><span class=menu-text>Handouts</span></a><ul class=dropdown-menu aria-labelledby=nav-menu-handouts><li><a class=dropdown-item href=../handouts/env_setup.html><span class=dropdown-text>Environment Setup</span></a><li><a class=dropdown-item href=../handouts/unix.html><span class=dropdown-text>Unix</span></a><li><a class=dropdown-item href=../handouts/privilege.html><span class=dropdown-text>Privilege</span></a><li><a class=dropdown-item href=../handouts/scheduler.html><span class=dropdown-text>Scheduler</span></a><li><a class=dropdown-item href=../handouts/buffercache.html><span class=dropdown-text>Buffer Cache</span></a><li><a class=dropdown-item href=../handouts/vm-page-size.html><span class=dropdown-text>Virtual Memory: Page Size</span></a></ul><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=nav-menu-labs role=link data-bs-toggle=dropdown aria-expanded=false><span class=menu-text>Labs</span></a><ul class=dropdown-menu aria-labelledby=nav-menu-labs><li><a class=dropdown-item href=../labs/mini-cloud.html><span class=dropdown-text>Mini Cloud</span></a><li><a class=dropdown-item href=../labs/linking.html><span class=dropdown-text>Linking</span></a><li><a class=dropdown-item href=../labs/process-creation.html><span class=dropdown-text>Process Creation</span></a><li><a class=dropdown-item href=../labs/process-state.html><span class=dropdown-text>Process State</span></a><li><a class=dropdown-item href=../labs/process-address-space.html><span class=dropdown-text>Process Address Space</span></a><li><hr class=dropdown-divider><li><a class=dropdown-item href=../labs/path-traversal.html><span class=dropdown-text>Path Traversal</span></a><li><a class=dropdown-item href=../labs/pipe-passwords.html><span class=dropdown-text>Pipe Passwords</span></a><li><a class=dropdown-item href=../labs/pipe-dup.html><span class=dropdown-text>Pipe and dup()</span></a><li><a class=dropdown-item href=../labs/pipe-pingpong.html><span class=dropdown-text>Pipe Ping-Pong</span></a><li><a class=dropdown-item href=../labs/fifo.html><span class=dropdown-text>FIFO (named pipe)</span></a><li><hr class=dropdown-divider><li><a class=dropdown-item href=../labs/cat.html><span class=dropdown-text>Cat</span></a><li><hr class=dropdown-divider><li><a class=dropdown-item href=../labs/xv6-syscall.html><span class=dropdown-text>xv6 System Call Tracing</span></a></ul><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=nav-menu-admin role=link data-bs-toggle=dropdown aria-expanded=false><span class=menu-text>Admin</span></a><ul class=dropdown-menu aria-labelledby=nav-menu-admin><li><a class=dropdown-item href=../admin/policies.html><span class=dropdown-text>Policies</span></a><li><a class=dropdown-item href=../admin/explore.html><span class=dropdown-text>Exploratory Projects</span></a><li><a class=dropdown-item href=../admin/waitbutwhy.html><span class=dropdown-text>SD1↓ (燒蛋一下)</span></a></ul></ul><ul class="navbar-nav navbar-nav-scroll ms-auto"><li class="nav-item compact"><a class=nav-link href="https://elearn.nthu.edu.tw/course/view.php?id=38873"><i class="bi bi-globe" role=img></i><span class=menu-text></span></a></ul></div><div class=quarto-navbar-tools></div></div></nav><nav class=quarto-secondary-nav><div class="container-fluid d-flex"><button type=button class="quarto-btn-toggle btn" data-bs-toggle=collapse role=button data-bs-target=.quarto-sidebar-collapse-item aria-controls=quarto-sidebar aria-expanded=false aria-label="Toggle sidebar navigation" onclick=window.quartoToggleHeadroom&&window.quartoToggleHeadroom()>
<i class="bi bi-layout-text-sidebar-reverse"></i></button><nav class=quarto-page-breadcrumbs aria-label=breadcrumb><ol class=breadcrumb></ol></nav><a class=flex-grow-1 role=navigation data-bs-toggle=collapse data-bs-target=.quarto-sidebar-collapse-item aria-controls=quarto-sidebar aria-expanded=false aria-label="Toggle sidebar navigation" onclick=window.quartoToggleHeadroom&&window.quartoToggleHeadroom()></a><button type=button class="btn quarto-search-button" aria-label=Search onclick=window.quartoOpenSearch()>
<i class="bi bi-search"></i></button></div></nav></header><div id=quarto-content class="quarto-container page-columns page-rows-contents page-layout-article page-navbar"><nav id=quarto-sidebar class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center"><div class=sidebar-search><div id=quarto-search title=Search></div></div></div><div class=sidebar-menu-container><ul class="list-unstyled mt-1"><li class=sidebar-item><div class=sidebar-item-container><a href=../index.html class="sidebar-item-text sidebar-link"><span class=menu-text>OS 2025 Fall</span></a></div><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w2.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 2</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-1 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-1 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/env_setup.html class="sidebar-item-text sidebar-link"><span class=menu-text>Environment setup</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w3.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 3</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-2 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-2 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/unix.html class="sidebar-item-text sidebar-link"><span class=menu-text>Unix Philosophy</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/mini-cloud.html class="sidebar-item-text sidebar-link"><span class=menu-text>Your First Week in OS Journey</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/process-creation.html class="sidebar-item-text sidebar-link"><span class=menu-text><code>fork()</code>/<code>exec()</code></span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w4.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 4</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-3 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-3 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/privilege.html class="sidebar-item-text sidebar-link"><span class=menu-text>Privilege</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/path-traversal.html class="sidebar-item-text sidebar-link"><span class=menu-text>Lab: Path Traversal Attack</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/process-address-space.html class="sidebar-item-text sidebar-link"><span class=menu-text>Address Space Layout</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/linking.html class="sidebar-item-text sidebar-link"><span class=menu-text>Static vs Dynamic Linking</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w5.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 5</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-4 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-4 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/pipe-passwords.html class="sidebar-item-text sidebar-link"><span class=menu-text>Parallelizing Rainbow Table Lookup with Pipes</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/pipe-dup.html class="sidebar-item-text sidebar-link"><span class=menu-text>Pipes, Redirection, and File Descriptors</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/fifo.html class="sidebar-item-text sidebar-link"><span class=menu-text>FIFO (named pipe)</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w6.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 6</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-5 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-5 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/scheduler.html class="sidebar-item-text sidebar-link"><span class=menu-text>Schedulers</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/process-state.html class="sidebar-item-text sidebar-link"><span class=menu-text>Process States in Linux</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/pipe-pingpong.html class="sidebar-item-text sidebar-link"><span class=menu-text>Pipe Pingpong</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w8.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 8</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-6 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-6 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/buffercache.html class="sidebar-item-text sidebar-link"><span class=menu-text>Caching and Buffering</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/cat.html class="sidebar-item-text sidebar-link"><span class=menu-text>How <code>cat</code> works?</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w9.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 9</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-7 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-7 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/xv6-intro.html class="sidebar-item-text sidebar-link"><span class=menu-text>Introduction to xv6</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/xv6-gdb.html class="sidebar-item-text sidebar-link"><span class=menu-text>GNU Debugger Tutorial</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/xv6-syscall.html class="sidebar-item-text sidebar-link"><span class=menu-text>xv6 Syscall Tracing</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w10.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 10</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-8 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-8 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/vm-page-size.html class="sidebar-item-text sidebar-link"><span class=menu-text>Why Android Moved to 16KB Pages</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w11.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 11</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-9 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-9 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/xv6-forkbomb.html class="sidebar-item-text sidebar-link"><span class=menu-text>xv6 Fork Bomb</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w12.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 12</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-10 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-10 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/event-driven-io.html class="sidebar-item-text sidebar-link"><span class=menu-text>Event-Driven I/O</span></a></div></ul></ul></div></nav><div id=quarto-sidebar-glass class=quarto-sidebar-collapse-item data-bs-toggle=collapse data-bs-target=.quarto-sidebar-collapse-item></div><div id=quarto-margin-sidebar class="sidebar margin-sidebar"><nav id=TOC role=doc-toc class=toc-active><h2 id=toc-title>On this page</h2><ul><li><a href=#worksheet-15-file-system id=toc-worksheet-15-file-system class="nav-link active" data-scroll-target=#worksheet-15-file-system>Worksheet 15: File-system</a><ul class=collapse><li><a href=#dream-coding id=toc-dream-coding class=nav-link data-scroll-target=#dream-coding>Dream Coding</a><ul class=collapse><li><a href=#time-machine-back-to-yesterday id=toc-time-machine-back-to-yesterday class=nav-link data-scroll-target=#time-machine-back-to-yesterday>Time Machine Back to Yesterday</a><li><a href=#back-to-filesystems id=toc-back-to-filesystems class=nav-link data-scroll-target=#back-to-filesystems>Back to Filesystems</a></ul><li><a href=#video-lecture id=toc-video-lecture class=nav-link data-scroll-target=#video-lecture>Video Lecture</a><li><a href=#readings id=toc-readings class=nav-link data-scroll-target=#readings>Readings</a><li><a href=#learning-objectives id=toc-learning-objectives class=nav-link data-scroll-target=#learning-objectives>Learning Objectives</a></ul></ul></nav></div><main class=content id=quarto-document-content><header id=title-block-header class=quarto-title-block></header><section id=worksheet-15-file-system class=level1><h1>Worksheet 15: File-system</h1><section id=dream-coding class=level2><h2 class=anchored data-anchor-id=dream-coding>Dream Coding</h2><p><img src=../images/niko-dream-coding.png class=img-fluid style=max-width:240px;float:right;margin-left:30px><p>Niko has a special talent: <strong>dream coding</strong>. He can write codes with eyes closed, and the quality is better than monkey punching keyboard. One night, he burns the midnight oil to implement the dining philosophers solution from OS lecture, because the demo is next morning.<p>Niko starts <span class=red><strong>dream coding</strong></span>:<p><strong>11:53 PM</strong>:<div class=sourceCode id=cb1><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id=cb1-1><a href=#cb1-1 aria-hidden=true tabindex=-1></a><span class=ex>$</span> vim dining_dogs.c</span>
<span id=cb1-2><a href=#cb1-2 aria-hidden=true tabindex=-1></a><span class=ex>[creates</span> the classic 5 dogs, 5 spoons problem]</span>
<span id=cb1-3><a href=#cb1-3 aria-hidden=true tabindex=-1></a><span class=ex>[dogs</span> keep deadlocking, all holding left spoon, waiting for right]</span>
<span id=cb1-4><a href=#cb1-4 aria-hidden=true tabindex=-1></a></span>
<span id=cb1-5><a href=#cb1-5 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git add dining_dogs.c</span>
<span id=cb1-6><a href=#cb1-6 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git commit <span class=at>-m</span> <span class=st>"add dining dogs deadlock problem"</span></span>
<span id=cb1-7><a href=#cb1-7 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git push origin master</span>
<span id=cb1-8><a href=#cb1-8 aria-hidden=true tabindex=-1></a><span class=ex>Pushed</span> to master</span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div><p><strong>12:15 AM</strong>:<div class=sourceCode id=cb2><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id=cb2-1><a href=#cb2-1 aria-hidden=true tabindex=-1></a><span class=ex>$</span> vim doghouse_sem.c</span>
<span id=cb2-2><a href=#cb2-2 aria-hidden=true tabindex=-1></a><span class=ex>[adds</span> doghouse semaphore with limit 4]</span>
<span id=cb2-3><a href=#cb2-3 aria-hidden=true tabindex=-1></a></span>
<span id=cb2-4><a href=#cb2-4 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git add doghouse_sem.c</span>
<span id=cb2-5><a href=#cb2-5 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git commit <span class=at>-m</span> <span class=st>"doghouse semaphore for concurrency throttling"</span></span>
<span id=cb2-6><a href=#cb2-6 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git push origin master</span>
<span id=cb2-7><a href=#cb2-7 aria-hidden=true tabindex=-1></a><span class=ex>Pushed</span> to master</span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div><p><strong>12:40 AM</strong>:<div class=sourceCode id=cb3><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id=cb3-1><a href=#cb3-1 aria-hidden=true tabindex=-1></a><span class=ex>$</span> vim dining_dogs.c</span>
<span id=cb3-2><a href=#cb3-2 aria-hidden=true tabindex=-1></a><span class=ex>[wiring</span> up sem_wait before entering doghouse]</span>
<span id=cb3-3><a href=#cb3-3 aria-hidden=true tabindex=-1></a><span class=ex>[adding</span> sem_post after leaving]</span>
<span id=cb3-4><a href=#cb3-4 aria-hidden=true tabindex=-1></a><span class=ex>[integrating</span> the throttling logic...]</span>
<span id=cb3-5><a href=#cb3-5 aria-hidden=true tabindex=-1></a></span>
<span id=cb3-6><a href=#cb3-6 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git add dining_dogs.c</span>
<span id=cb3-7><a href=#cb3-7 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git commit <span class=at>-m</span> <span class=st>"integrate doghouse throttling to prevent deadlock"</span></span>
<span id=cb3-8><a href=#cb3-8 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git push origin master</span>
<span id=cb3-9><a href=#cb3-9 aria-hidden=true tabindex=-1></a><span class=ex>Pushing...</span> 43%... 67%...</span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div><p><strong>12:41 AM</strong>: Niko finally falls asleep after 8-hours non-stop working.<p><img src=../images/niko-die.png class=img-fluid style=max-width:240px><hr><p><strong>Next Morning - 9:00 AM</strong><p>Capoo arrives at the office and pulls latest code:<div class=sourceCode id=cb4><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id=cb4-1><a href=#cb4-1 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git pull origin master</span>
<span id=cb4-2><a href=#cb4-2 aria-hidden=true tabindex=-1></a></span>
<span id=cb4-3><a href=#cb4-3 aria-hidden=true tabindex=-1></a><span class=ex>Updating</span> a3f829c..e8b9d12</span>
<span id=cb4-4><a href=#cb4-4 aria-hidden=true tabindex=-1></a><span class=ex>Fast-forward</span></span>
<span id=cb4-5><a href=#cb4-5 aria-hidden=true tabindex=-1></a> <span class=ex>dining_dogs.c</span>    <span class=kw>|</span> <span class=ex>67</span> +++++++++++++++++</span>
<span id=cb4-6><a href=#cb4-6 aria-hidden=true tabindex=-1></a> <span class=ex>doghouse_sem.c</span>   <span class=kw>|</span> <span class=ex>23</span> ++++++++</span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div><p>Capoo opens <code>dining_dogs.c</code>:<div class=sourceCode id=cb5><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id=cb5-1><a href=#cb5-1 aria-hidden=true tabindex=-1></a><span class=co>// 5 dogs trying to eat with 5 spoons (forks)</span></span>
<span id=cb5-2><a href=#cb5-2 aria-hidden=true tabindex=-1></a><span class=dt>void</span><span class=op>*</span> dog<span class=op>(</span><span class=dt>void</span><span class=op>*</span> arg<span class=op>)</span> <span class=op>{</span></span>
<span id=cb5-3><a href=#cb5-3 aria-hidden=true tabindex=-1></a>    <span class=dt>int</span> id <span class=op>=</span> <span class=op>*(</span><span class=dt>int</span><span class=op>*)</span>arg<span class=op>;</span></span>
<span id=cb5-4><a href=#cb5-4 aria-hidden=true tabindex=-1></a>    <span class=dt>int</span> a<span class=op>,</span> b<span class=op>,</span> c<span class=op>;</span></span>
<span id=cb5-5><a href=#cb5-5 aria-hidden=true tabindex=-1></a>    </span>
<span id=cb5-6><a href=#cb5-6 aria-hidden=true tabindex=-1></a>    <span class=cf>while</span><span class=op>(</span><span class=dv>1</span><span class=op>)</span> <span class=op>{</span></span>
<span id=cb5-7><a href=#cb5-7 aria-hidden=true tabindex=-1></a>        drooling<span class=op>();</span> <span class=co>// Hungry @_@</span></span>
<span id=cb5-8><a href=#cb5-8 aria-hidden=true tabindex=-1></a>        </span>
<span id=cb5-9><a href=#cb5-9 aria-hidden=true tabindex=-1></a>        <span class=co>// Try to pick up spoons</span></span>
<span id=cb5-10><a href=#cb5-10 aria-hidden=true tabindex=-1></a>        pthread_mutex_lock<span class=op>(&amp;</span>spoon<span class=op>[</span>id<span class=op>]);</span>           <span class=co>// Pick left spoon</span></span>
<span id=cb5-11><a href=#cb5-11 aria-hidden=true tabindex=-1></a>        pthread_mutex_lock<span class=op>(&amp;</span>spoon<span class=op>[(</span>id<span class=op>+</span><span class=dv>1</span><span class=op>)</span> <span class=op>%</span> <span class=dv>5</span><span class=op>]);</span>   <span class=co>// Pick right spoon</span></span>
<span id=cb5-12><a href=#cb5-12 aria-hidden=true tabindex=-1></a>        </span>
<span id=cb5-13><a href=#cb5-13 aria-hidden=true tabindex=-1></a>        eat_dogfood<span class=op>(</span>id<span class=op>);</span> <span class=co>// like a king</span></span>
<span id=cb5-14><a href=#cb5-14 aria-hidden=true tabindex=-1></a>        </span>
<span id=cb5-15><a href=#cb5-15 aria-hidden=true tabindex=-1></a>        <span class=co>// Put down spoons</span></span>
<span id=cb5-16><a href=#cb5-16 aria-hidden=true tabindex=-1></a>        pthread_mutex_unlock<span class=op>(&amp;</span>spoon<span class=op>[??]);</span></span>
<span id=cb5-17><a href=#cb5-17 aria-hidden=true tabindex=-1></a>        pthread_mutex_unlock<span class=op>(&amp;</span>spoon<span class=op>[??]);</span></span>
<span id=cb5-18><a href=#cb5-18 aria-hidden=true tabindex=-1></a><span class=op>}</span></span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div><p>Capoo opens <code>doghouse_sem.c</code>:<div class=sourceCode id=cb6><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id=cb6-1><a href=#cb6-1 aria-hidden=true tabindex=-1></a>sem_t doghouse<span class=op>;</span></span>
<span id=cb6-2><a href=#cb6-2 aria-hidden=true tabindex=-1></a></span>
<span id=cb6-3><a href=#cb6-3 aria-hidden=true tabindex=-1></a>sem_init<span class=op>(&amp;</span>doghouse<span class=op>,</span> <span class=dv>0</span><span class=op>,</span> <span class=op>???);</span></span>
<span id=cb6-4><a href=#cb6-4 aria-hidden=true tabindex=-1></a></span>
<span id=cb6-5><a href=#cb6-5 aria-hidden=true tabindex=-1></a><span class=co>// 4 dogs can enter doghouse at once</span></span>
<span id=cb6-6><a href=#cb6-6 aria-hidden=true tabindex=-1></a><span class=co>// With 4 dogs and 5 spoons, no deadlock</span></span>
<span id=cb6-7><a href=#cb6-7 aria-hidden=true tabindex=-1></a>sem_wait<span class=op>(???)</span></span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div><p><span class=red>“WHAT THE …”</span> Capoo’s coffee spills.<p><strong><span class=blue>“Don’t even compile. What are these random variables <code>int a, b, c</code>? And <code>sem_wait(???)</code>? Wait on WHAT?”</span></strong><p>The code is just messy <strong>torn writes</strong>. (´･ω･`)<p>Capoo runs into Nini’s office.<p><strong>Capoo:</strong> “Niko pushed the dining dogs code but it’s garbage.”<p><strong>Nini:</strong> “Where’s Niko?”<p><strong>Capoo:</strong> “Still asleep at his desk.””<p><strong>Nini sigh:</strong> “Classic torn write problem. He brain dumped everything but crashed in the middle.”<hr><p>Nini calls Niko into the office. Niko looks like a zombie.<div class="quarto-figure quarto-figure-center" style=max-width:360px;float:right;margin-left:30px><figure class=figure><p><img src=../images/nini-pr.png class="img-fluid figure-img"><figcaption><strong>Niko tired as dog</strong></figcaption></figure></div><p><strong>Nini:</strong> “Man. You committed broken code … Do you even remember what you were doing?”<p><strong>Niko</strong> (tired as dog): “Eh .. I… I learned about concurrency throttling in OS lecture. You limit 4 dogs in the doghouse. Then deadlock can’t happen because… uh…”<p><strong>Nini:</strong> “Right! But your code contains garbage like <code>sem_wait(???)</code>. Nobody knows what the heck you try to do!”<p><strong>Nini:</strong> “<strong>Now LISTEN. Before you write a single line of code, create a pull request (PR) FIRST</strong>.”</p><p><span class=green>“<strong>If you pass out next time, Capoo could at least throw your PR to Gemini Code. OK?</strong>”</span><section id=time-machine-back-to-yesterday class=level3><h3 class=anchored data-anchor-id=time-machine-back-to-yesterday>Time Machine Back to Yesterday</h3><p><strong>11:30 PM - Same Situation, Different Approach</strong><p>Niko travels on a time machine and goes back to last night. This time, he remembers Nini’s rule: <strong><span class=green>“PR before dream coding.”</span></strong><p>Opens GitHub, clicks “New Pull Request”:<div class="callout callout-style-default callout-note callout-titled"><div class="callout-header d-flex align-content-center" data-bs-toggle=collapse data-bs-target=.callout-1-contents aria-controls=callout-1 aria-expanded=false aria-label="Toggle callout"><div class=callout-icon-container><i class=callout-icon></i></div><div class="callout-title-container flex-fill">PR: Dining Dogs Deadlock Prevention</div><div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class=callout-toggle></i></div></div><div id=callout-1 class="callout-1-contents callout-collapse collapse"><div class="callout-body-container callout-body"><div class=sourceCode id=cb7><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id=cb7-1><a href=#cb7-1 aria-hidden=true tabindex=-1></a><span class=fu>### Problem</span></span>
<span id=cb7-2><a href=#cb7-2 aria-hidden=true tabindex=-1></a>5 dogs, 5 spoons, classic deadlock when all grab left spoon simultaneously.</span>
<span id=cb7-3><a href=#cb7-3 aria-hidden=true tabindex=-1></a></span>
<span id=cb7-4><a href=#cb7-4 aria-hidden=true tabindex=-1></a><span class=fu>### Solution  </span></span>
<span id=cb7-5><a href=#cb7-5 aria-hidden=true tabindex=-1></a>Doghouse semaphore with limit 4. Only 4 dogs allowed in the doghouse.</span>
<span id=cb7-6><a href=#cb7-6 aria-hidden=true tabindex=-1></a>With 4 dogs and 5 spoons, deadlock impossible (always a spare spoon).</span>
<span id=cb7-7><a href=#cb7-7 aria-hidden=true tabindex=-1></a></span>
<span id=cb7-8><a href=#cb7-8 aria-hidden=true tabindex=-1></a><span class=fu>### Implementation Steps</span></span>
<span id=cb7-9><a href=#cb7-9 aria-hidden=true tabindex=-1></a><span class=ss>1. </span>Create dining_dogs.c with deadlock problem</span>
<span id=cb7-10><a href=#cb7-10 aria-hidden=true tabindex=-1></a><span class=ss>2. </span>Create doghouse_sem.c with semaphore (init value = 4)</span>
<span id=cb7-11><a href=#cb7-11 aria-hidden=true tabindex=-1></a><span class=ss>3. </span>Add sem_wait(&amp;doghouse) before dog enters</span>
<span id=cb7-12><a href=#cb7-12 aria-hidden=true tabindex=-1></a><span class=ss>4. </span>Add sem_post(&amp;doghouse) after dog leaves  </span>
<span id=cb7-13><a href=#cb7-13 aria-hidden=true tabindex=-1></a><span class=ss>5. </span>Initialize semaphore in main() with value 4</span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div></div></div></div><p><strong>11:45 PM</strong> - Niko clicks “<strong>Create Pull Request</strong>”, and starts coding:<div class=sourceCode id=cb8><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id=cb8-1><a href=#cb8-1 aria-hidden=true tabindex=-1></a><span class=ex>$</span> vim dining_dogs.c</span>
<span id=cb8-2><a href=#cb8-2 aria-hidden=true tabindex=-1></a><span class=ex>[creates</span> dog function with mutex locks]</span>
<span id=cb8-3><a href=#cb8-3 aria-hidden=true tabindex=-1></a><span class=ex>[creates</span> the deadlock scenario]</span>
<span id=cb8-4><a href=#cb8-4 aria-hidden=true tabindex=-1></a></span>
<span id=cb8-5><a href=#cb8-5 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git add dining_dogs.c</span>
<span id=cb8-6><a href=#cb8-6 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git commit <span class=at>-m</span> <span class=st>"PR: Step 1 - Create dining dogs deadlock problem"</span></span>
<span id=cb8-7><a href=#cb8-7 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git push origin feature/doghouse-deadlock-prevention</span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div><p><strong>12:05 AM</strong> - Continues:<div class=sourceCode id=cb9><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id=cb9-1><a href=#cb9-1 aria-hidden=true tabindex=-1></a><span class=ex>$</span> vim doghouse_sem.c</span>
<span id=cb9-2><a href=#cb9-2 aria-hidden=true tabindex=-1></a><span class=ex>[declares</span> sem_t doghouse]</span>
<span id=cb9-3><a href=#cb9-3 aria-hidden=true tabindex=-1></a><span class=ex>[adds</span> initialization code: sem_init<span class=er>(</span><span class=kw>&amp;</span><span class=ex>doghouse,</span> 0, 4<span class=kw>)</span><span class=ex>]</span></span>
<span id=cb9-4><a href=#cb9-4 aria-hidden=true tabindex=-1></a></span>
<span id=cb9-5><a href=#cb9-5 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git commit <span class=at>-m</span> <span class=st>"PR: Step 2 - Create doghouse semaphore with limit 4"</span></span>
<span id=cb9-6><a href=#cb9-6 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git push origin feature/doghouse-deadlock-prevention</span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div><p><strong>12:23 AM</strong> - Niko passed out again …<hr><p><strong>Next Morning - 8:45 AM</strong><p>Capoo arrives office, <code>git pull</code>, check out the PR branch. He continues to open Gemini Code and types:<p><img src=../images/gemini-v2.png class=img-fluid style=max-width:600px><p>… done after Capoo drinks a cup of coffee. (✪ω✪)<p><img src=../images/capoo-gemini.png class=img-fluid style=max-width:240px><p><strong>8:50 AM</strong> - Capoo <code>git push</code>:<div class=sourceCode id=cb10><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id=cb10-1><a href=#cb10-1 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git add <span class=pp>*</span>.c</span>
<span id=cb10-2><a href=#cb10-2 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git commit <span class=at>-m</span> <span class=st>"PR: Complete Steps 3-5 using PR description"</span></span>
<span id=cb10-3><a href=#cb10-3 aria-hidden=true tabindex=-1></a><span class=ex>$</span> git push origin feature/doghouse-deadlock-prevention</span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div><p><strong>9:00 AM</strong> - Capoo pokes Niko on Discord:<p><strong>Capoo:</strong> Good morning, bro. <span class=green>“<strong>Finished your doghouse deadlock prevention. Just threw your PR.md at Gemini Code, done in 10 minutes.</strong>”</span> like a breeze. (◕ܫ◕)<p><strong>Niko</strong> (just wake up): “Wait, Google mini Doge?”<p><strong>Capoo:</strong> <span class=green>“<strong>Yes. A piece of fish for the Google AI. Your PR was our write-ahead-log-style journal.</strong>”</span><p><span class=blue>“<strong>After you crashed, the AI replayed the journal to fix your broken dreamed code.</strong>”</span><p><strong>Niko:</strong> <span class=big>“Le Mao.”</span></section><section id=back-to-filesystems class=level3><h3 class=anchored data-anchor-id=back-to-filesystems>Back to Filesystems</h3><p>Appending new data to a file requires updates to multiple blocks: allocate a block, write data, mark it used, update the inode and directory metadata. A power failure mid-update leaves the filesystem in a strange states, like: data written but unreachable, or size wrong, or wrong block reused.<p>Journaling fixes this by first recording the entire plan in a write-ahead log. Only after the journal is safely stored does the filesystem perform the real operations. If a crash occurs, the journal is replayed to perform any incomplete steps so the file-system ends up consistent (either fully appended or untouched, never half-baked).<p><span class=red><strong>Watch this week’s lecture if you have no idea what I’m mumbling.</strong></span><p><span class=blue><strong>I don’t know anyone except Niko who can do dream coding. I myself can do dream debugging, though.</strong></span></section></section><section id=video-lecture class=level2><h2 class=anchored data-anchor-id=video-lecture>Video Lecture</h2><p>Remember to open the English subtitle on Youtube: <a href="https://elearn.nthu.edu.tw/mod/url/view.php?id=215891">eLearn link of the video lecture</a><p>(◕ܫ◕) (◕ܫ◕)<p><span class=red><strong>!!有繁體中文字幕!!</strong></span></section><section id=readings class=level2><h2 class=anchored data-anchor-id=readings>Readings</h2><ul><li><a href=../handouts/ipod.html>The stories of three file systems</a><li><a href=https://pages.cs.wisc.edu/~remzi/OSTEP/file-implementation.pdf>Textbook: File-system Implementation</a></ul></section><section id=learning-objectives class=level2><h2 class=anchored data-anchor-id=learning-objectives>Learning Objectives</h2><p>I understand the following concepts:<ul><li>Virtual File-system (VFS)<li>What “mounting a file-system” means<li>The content of superblock, inode<li>ext2 inode structure: the direct pointer / single indirect pointer / double indirect pointer / triple indirect pointer, and how to calculate the maximum supported file size.<li>Dentry and dentry cache<li>Path resolution<li>Torn writes<li>The Atomic Rename Trick<li>Write Ahead Logging: journal writes, checkpoint, free, journal replay</ul></section></section><a onclick="return window.scrollTo(0,0),!1" role=button id=quarto-back-to-top><i class="bi bi-arrow-up"></i> Back to top</a></main><script id=quarto-html-after-body>window.document.addEventListener("DOMContentLoaded",function(){const j="",c=new window.AnchorJS;c.options={placement:"right",icon:j},c.add(".anchored");const v=e=>{for(const t of e.classList)if(t.startsWith("code-annotation-"))return!0;return!1},p=function(e){const t=e.trigger;t.blur(),t.classList.add("code-copy-button-checked");var s=t.getAttribute("title");t.setAttribute("title","Copied!");let n;window.bootstrap&&(t.setAttribute("data-bs-toggle","tooltip"),t.setAttribute("data-bs-placement","left"),t.setAttribute("data-bs-title","Copied!"),n=new bootstrap.Tooltip(t,{trigger:"manual",customClass:"code-copy-button-tooltip",offset:[0,-8]}),n.show()),setTimeout(function(){n&&(n.hide(),t.removeAttribute("data-bs-title"),t.removeAttribute("data-bs-toggle"),t.removeAttribute("data-bs-placement")),t.setAttribute("title",s),t.classList.remove("code-copy-button-checked")},1e3),e.clearSelection()},m=function(e){const t=e.previousElementSibling.cloneNode(!0);for(const e of t.children)v(e)&&e.remove();return t.innerText},b=new window.ClipboardJS(".code-copy-button:not([data-in-quarto-modal])",{text:m});if(b.on("success",p),window.document.getElementById("quarto-embedded-source-code-modal")){const e=new window.ClipboardJS(".code-copy-button[data-in-quarto-modal]",{text:m,container:window.document.getElementById("quarto-embedded-source-code-modal")});e.on("success",p)}for(var s,g=new RegExp(/^(?:http|https):\/\/localhost:?[0-9]*\//),x=new RegExp(/^mailto:/),O=new RegExp("/"+window.location.host+"/"),w=e=>O.test(e)||g.test(e)||x.test(e),u=window.document.querySelectorAll("a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)"),t=0;t<u.length;t++){const e=u[t];w(e.href)||(e.dataset.originalHref!==0[0]&&(e.href=e.dataset.originalHref),e.setAttribute("target","_blank"),e.getAttribute("rel")===null&&e.setAttribute("rel","noopener"),e.classList.add("external"))}function i(e,t,n,s){const o={allowHTML:!0,maxWidth:500,delay:100,arrow:!1,appendTo:function(e){return e.parentElement},interactive:!0,interactiveBorder:10,theme:"quarto",placement:"bottom-start"};t&&(o.content=t),n&&(o.onTrigger=n),s&&(o.onUntrigger=s),window.tippy(e,o)}const f=window.document.querySelectorAll('a[role="doc-noteref"]');for(t=0;t<f.length;t++){const e=f[t];i(e,function(){let t=e.getAttribute("data-footnote-href")||e.getAttribute("href");try{t=new URL(t).hash}catch{}const s=t.replace(/^#\/?/,""),n=window.document.getElementById(s);return n?n.innerHTML:""})}const r=window.document.querySelectorAll("a.quarto-xref"),o=(e,t)=>{const n=e=>{if(e.classList.remove("page-full","page-columns"),e.children)for(const t of e.children)n(t)};if(n(t),e===null||e.startsWith("sec-")){const e=document.createElement("div");if(t.children&&t.children.length>2){e.appendChild(t.children[0].cloneNode(!0));for(let n=1;n<t.children.length;n++){const s=t.children[n];if(s.tagName==="P"&&s.innerText==="")continue;e.appendChild(s.cloneNode(!0));break}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(e),e.innerHTML}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(t),t.innerHTML}else{const e=t.querySelector("a.anchorjs-link");return e&&e.remove(),window.Quarto?.typesetMath&&window.Quarto.typesetMath(t),t.classList.contains("callout")?t.outerHTML:t.innerHTML}};for(t=0;t<r.length;t++){const e=r[t];i(e,0[0],function(t){t.disable();let n=e.getAttribute("href"),s=0[0];if(n.startsWith("#"))s=n;else try{s=new URL(n).hash}catch{}if(s){const e=s.replace(/^#\/?/,""),i=window.document.getElementById(e);if(i!==null)try{const n=o(e,i.cloneNode(!0));t.setContent(n)}finally{t.enable(),t.show()}else fetch(n.split("#")[0]).then(e=>e.text()).then(n=>{const i=new DOMParser,a=i.parseFromString(n,"text/html"),s=a.getElementById(e);if(s!==null){const n=o(e,s);t.setContent(n)}}).finally(()=>{t.enable(),t.show()})}else fetch(n).then(e=>e.text()).then(e=>{const s=new DOMParser,i=s.parseFromString(e,"text/html"),n=i.querySelector("main.content");if(n!==null){n.children.length>0&&n.children[0].tagName==="HEADER"&&n.children[0].remove();const e=o(null,n);t.setContent(e)}}).finally(()=>{t.enable(),t.show()})},function(){})}let n;const h=(e,t)=>{let n='data-code-cell="'+e+'"',s='data-code-annotation="'+t+'"';const o="span["+n+"]["+s+"]";return o},a=e=>{const d=window.document,i=e.getAttribute("data-target-cell"),r=e.getAttribute("data-target-annotation"),c=window.document.querySelector(h(i,r)),l=c.getAttribute("data-code-lines").split(","),t=l.map(e=>i+"-"+e);let s=null,o=null,a=null;if(t.length>0){const r=window.document.getElementById(t[0]);if(s=r.offsetTop,o=r.offsetHeight,a=r.parentElement.parentElement,t.length>1){const e=window.document.getElementById(t[t.length-1]),n=e.offsetTop+e.offsetHeight;o=n-s}if(s!==null&&o!==null&&a!==null){let e=window.document.getElementById("code-annotation-line-highlight");e===null&&(e=window.document.createElement("div"),e.setAttribute("id","code-annotation-line-highlight"),e.style.position="absolute",a.appendChild(e)),e.style.top=s-2+"px",e.style.height=o+4+"px",e.style.left=0;let t=window.document.getElementById("code-annotation-line-highlight-gutter");if(t===null){t=window.document.createElement("div"),t.setAttribute("id","code-annotation-line-highlight-gutter"),t.style.position="absolute";const e=window.document.getElementById(i),n=e.querySelector(".code-annotation-gutter");n.appendChild(t)}t.style.top=s-2+"px",t.style.height=o+4+"px"}n=e}},y=()=>{const e=["code-annotation-line-highlight","code-annotation-line-highlight-gutter"];e.forEach(e=>{const t=window.document.getElementById(e);t&&t.remove()}),n=0[0]};window.addEventListener("resize",_(()=>{elRect=0[0],n&&a(n)},10));function _(e,t){let s=!1,n;return(...o)=>{s?(n&&clearTimeout(n),n=setTimeout(()=>{e.apply(this,o),n=s=!1},t)):(e.apply(this,o),s=!0)}}const d=window.document.querySelectorAll(".code-annotation-anchor");for(let e=0;e<d.length;e++){const t=d[e],n=t.getAttribute("data-target-cell"),s=t.getAttribute("data-target-annotation"),o=()=>{const e=window.document.querySelector(h(n,s));if(e){const t=e.cloneNode(!0);return t.classList.add("code-annotation-tip-content"),t.outerHTML}},i={allowHTML:!0,content:o,onShow:e=>{a(e.reference),e.reference.classList.add("code-annotation-active"),window.tippy.hideAll()},onHide:e=>{y(),e.reference.classList.remove("code-annotation-active")},maxWidth:300,delay:[50,0],duration:[200,0],offset:[5,10],arrow:!0,appendTo:function(e){return e.parentElement.parentElement.parentElement},interactive:!0,interactiveBorder:10,theme:"quarto",placement:"right",popperOptions:{modifiers:[{name:"flip",options:{flipVariations:!1,allowedAutoPlacements:["right"],fallbackPlacements:["right","top","top-start","top-end","bottom","bottom-start","bottom-end","left"]}},{name:"preventOverflow",options:{mainAxis:!1,altAxis:!1}}]}};window.tippy(t,i)}const l=e=>{const t=e.parentElement;if(t){const n=t.dataset.cites;return n?{el:e,cites:n.split(" ")}:l(e.parentElement)}else return 0[0]};for(s=window.document.querySelectorAll('a[role="doc-biblioref"]'),t=0;t<s.length;t++){const n=s[t],e=l(n);e&&i(e.el,function(){var t=window.document.createElement("div");return e.cites.forEach(function(e){var s,n=window.document.createElement("div");n.classList.add("hanging-indent"),n.classList.add("csl-entry"),s=window.document.getElementById("ref-"+e),s&&(n.innerHTML=s.innerHTML),t.appendChild(n)}),t.innerHTML})}})</script></div><footer class=footer><div class=nav-footer><div class=nav-footer-left><p><img id=footer-cat-left src=../images/cat-left.png alt="Cat Left"></div><div class=nav-footer-center><p><span id=footer-center>Made with ❤️ by Tony, (CC&nbsp;BY&nbsp;4.0)<br><span style=font-size:8px>Cat source: Freepik and ChatGPT</span></span></div><div class=nav-footer-right><p><img id=footer-cat-right src=../images/cat-right.png alt="Cat Right"></div></div></footer>