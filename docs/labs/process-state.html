<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=en xml:lang=en><meta charset=utf-8><meta name=generator content="quarto-1.7.33"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes"><title>process-state – Operating System (2025 Fall)</title><style>code{white-space:pre-wrap}span.smallcaps{font-variant:small-caps}div.columns{display:flex;gap:min(4vw,1.5em)}div.column{flex:auto;overflow-x:auto}div.hanging-indent{margin-left:1.5em;text-indent:-1.5em}ul.task-list{list-style:none}ul.task-list li input[type=checkbox]{width:.8em;margin:0 .8em .2em -1em;vertical-align:middle}html{-webkit-text-size-adjust:100%}pre>code.sourceCode{white-space:pre;position:relative}pre>code.sourceCode>span{display:inline-block;line-height:1.25}pre>code.sourceCode>span:empty{height:1.2em}.sourceCode{overflow:visible}code.sourceCode>span{color:inherit;text-decoration:inherit}div.sourceCode{margin:1em 0}pre.sourceCode{margin:0}@media screen{div.sourceCode{overflow:auto}}@media print{pre>code.sourceCode{white-space:pre-wrap}pre>code.sourceCode>span{text-indent:-5em;padding-left:5em}}pre.numberSource code{counter-reset:source-line 0}pre.numberSource code>span{position:relative;left:-4em;counter-increment:source-line}pre.numberSource code>span>a:first-child::before{content:counter(source-line);position:relative;left:-1em;text-align:right;vertical-align:baseline;border:none;display:inline-block;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;padding:0 4px;width:4em}pre.numberSource{margin-left:3em;padding-left:4px}div.sourceCode{}@media screen{pre>code.sourceCode>span>a:first-child::before{text-decoration:underline}}</style><script src=../site_libs/quarto-nav/quarto-nav.js></script><script src=../site_libs/clipboard/clipboard.min.js></script><script src=../site_libs/quarto-search/autocomplete.umd.js></script><script src=../site_libs/quarto-search/fuse.min.js></script><script src=../site_libs/quarto-search/quarto-search.js></script><meta name=quarto:offset content="../"><link href=../images/orange.png rel=icon type=image/png><script src=../site_libs/quarto-html/quarto.js type=module></script><script src=../site_libs/quarto-html/tabsets/tabsets.js type=module></script><script src=../site_libs/quarto-html/popper.min.js></script><script src=../site_libs/quarto-html/tippy.umd.min.js></script><script src=../site_libs/quarto-html/anchor.min.js></script><link href=../site_libs/quarto-html/tippy.css rel=stylesheet><link href=../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css rel=stylesheet id=quarto-text-highlighting-styles><script src=../site_libs/bootstrap/bootstrap.min.js></script><link href=../site_libs/bootstrap/bootstrap-icons.css rel=stylesheet><link href=../site_libs/bootstrap/bootstrap-a3d6f4078ec9f2632a80ad631344d584.min.css rel=stylesheet append-hash=true id=quarto-bootstrap data-mode=light><script id=quarto-search-options type=application/json>{"location":"navbar","copy-button":false,"collapse-after":3,"panel-placement":"end","type":"overlay","limit":50,"keyboard-shortcut":["f","/","s"],"show-item-context":false,"language":{"search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search"}}</script><body class="nav-sidebar docked nav-fixed slimcontent quarto-light"><div id=quarto-search-results></div><header id=quarto-header class="headroom fixed-top"><nav class="navbar navbar-expand-lg" data-bs-theme=dark><div class="navbar-container container-fluid"><div class="navbar-brand-container mx-auto"><a class=navbar-brand href=../index.html><span class=navbar-title>Operating System (2025 Fall)</span></a></div><div id=quarto-search title=Search></div><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarCollapse aria-controls=navbarCollapse role=menu aria-expanded=false aria-label="Toggle navigation" onclick=window.quartoToggleHeadroom&&window.quartoToggleHeadroom()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarCollapse><ul class="navbar-nav navbar-nav-scroll me-auto"><li class=nav-item><a class="nav-link active" href=../index.html aria-current=page><span class=menu-text>Home</span></a><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=nav-menu-handouts role=link data-bs-toggle=dropdown aria-expanded=false><span class=menu-text>Handouts</span></a><ul class=dropdown-menu aria-labelledby=nav-menu-handouts><li><a class=dropdown-item href=../handouts/env_setup.html><span class=dropdown-text>Enviroment setup</span></a></ul><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=nav-menu-admin role=link data-bs-toggle=dropdown aria-expanded=false><span class=menu-text>Admin</span></a><ul class=dropdown-menu aria-labelledby=nav-menu-admin><li><a class=dropdown-item href=../admin/policies.html><span class=dropdown-text>Policies</span></a><li><a class=dropdown-item href=../admin/explore.html><span class=dropdown-text>Exploratory Projects</span></a><li><a class=dropdown-item href=../admin/waitbutwhy.html><span class=dropdown-text>SD1↓ (燒蛋一下)</span></a></ul></ul><ul class="navbar-nav navbar-nav-scroll ms-auto"><li class="nav-item compact"><a class=nav-link href=https://dcs.site.nthu.edu.tw/><i class="bi bi-globe" role=img></i><span class=menu-text></span></a></ul></div><div class=quarto-navbar-tools></div></div></nav><nav class=quarto-secondary-nav><div class="container-fluid d-flex"><button type=button class="quarto-btn-toggle btn" data-bs-toggle=collapse role=button data-bs-target=.quarto-sidebar-collapse-item aria-controls=quarto-sidebar aria-expanded=false aria-label="Toggle sidebar navigation" onclick=window.quartoToggleHeadroom&&window.quartoToggleHeadroom()>
<i class="bi bi-layout-text-sidebar-reverse"></i></button><nav class=quarto-page-breadcrumbs aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=../weeks/w6.html>Worksheet 6</a><li class=breadcrumb-item><a href=../labs/process-state.html>Process States in Linux</a></ol></nav><a class=flex-grow-1 role=navigation data-bs-toggle=collapse data-bs-target=.quarto-sidebar-collapse-item aria-controls=quarto-sidebar aria-expanded=false aria-label="Toggle sidebar navigation" onclick=window.quartoToggleHeadroom&&window.quartoToggleHeadroom()></a><button type=button class="btn quarto-search-button" aria-label=Search onclick=window.quartoOpenSearch()>
<i class="bi bi-search"></i></button></div></nav></header><div id=quarto-content class="quarto-container page-columns page-rows-contents page-layout-article page-navbar"><nav id=quarto-sidebar class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center"><div class=sidebar-search><div id=quarto-search title=Search></div></div></div><div class=sidebar-menu-container><ul class="list-unstyled mt-1"><li class=sidebar-item><div class=sidebar-item-container><a href=../index.html class="sidebar-item-text sidebar-link"><span class=menu-text>OS 2025 Fall</span></a></div><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w2.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 2</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-1 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-1 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/env_setup.html class="sidebar-item-text sidebar-link"><span class=menu-text>Environment setup</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w3.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 3</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-2 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-2 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/unix.html class="sidebar-item-text sidebar-link"><span class=menu-text>Unix Philosophy</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/mini-cloud.html class="sidebar-item-text sidebar-link"><span class=menu-text>Your First Week in OS Journey</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/process-creation.html class="sidebar-item-text sidebar-link"><span class=menu-text><code>fork()</code>/<code>exec()</code></span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w4.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 4</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-3 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-3 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/privilege.html class="sidebar-item-text sidebar-link"><span class=menu-text>Privilege</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/path-traversal.html class="sidebar-item-text sidebar-link"><span class=menu-text>Lab: Path Traversal Attack</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/process-address-space.html class="sidebar-item-text sidebar-link"><span class=menu-text>Address Space Layout</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/linking.html class="sidebar-item-text sidebar-link"><span class=menu-text>Static vs Dynamic Linking</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w5.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 5</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-4 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-4 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/pipe-passwords.html class="sidebar-item-text sidebar-link"><span class=menu-text>Parallelizing Rainbow Table Lookup with Pipes</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/pipe-dup.html class="sidebar-item-text sidebar-link"><span class=menu-text>Pipes, Redirection, and File Descriptors</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/fifo.html class="sidebar-item-text sidebar-link"><span class=menu-text>FIFO (named pipe)</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w6.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 6</span></a>
<a class="sidebar-item-toggle text-start" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-5 role=navigation aria-expanded=true aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-5 class="collapse list-unstyled sidebar-section depth1 show"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/scheduler.html class="sidebar-item-text sidebar-link"><span class=menu-text>Schedulers</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/process-state.html class="sidebar-item-text sidebar-link active"><span class=menu-text>Process States in Linux</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/pipe-pingpong.html class="sidebar-item-text sidebar-link"><span class=menu-text>Pipe Pingpong</span></a></div></ul></ul></div></nav><div id=quarto-sidebar-glass class=quarto-sidebar-collapse-item data-bs-toggle=collapse data-bs-target=.quarto-sidebar-collapse-item></div><div id=quarto-margin-sidebar class="sidebar margin-sidebar"><nav id=TOC role=doc-toc class=toc-active><h2 id=toc-title>On this page</h2><ul><li><a href=#process-states-in-linux id=toc-process-states-in-linux class="nav-link active" data-scroll-target=#process-states-in-linux>Process States in Linux</a><ul class=collapse><li><a href=#process-states id=toc-process-states class=nav-link data-scroll-target=#process-states>Process States</a><li><a href=#case-studies-htop-in-the-wild id=toc-case-studies-htop-in-the-wild class=nav-link data-scroll-target=#case-studies-htop-in-the-wild>Case Studies: <code>htop</code> in the Wild</a><ul class=collapse><li><a href=#case-1-database-server id=toc-case-1-database-server class=nav-link data-scroll-target=#case-1-database-server>Case 1: Database Server</a><li><a href=#case-2-cpu-bound-hpc-job id=toc-case-2-cpu-bound-hpc-job class=nav-link data-scroll-target=#case-2-cpu-bound-hpc-job>Case 2: CPU-bound HPC Job</a><li><a href=#case-3-io-bound-hpc-job id=toc-case-3-io-bound-hpc-job class=nav-link data-scroll-target=#case-3-io-bound-hpc-job>Case 3: I/O-bound HPC Job</a><li><a href=#case-4-parallel-processing-with-data-download id=toc-case-4-parallel-processing-with-data-download class=nav-link data-scroll-target=#case-4-parallel-processing-with-data-download>Case 4: Parallel Processing with Data Download</a><li><a href=#create-your-own-workloads id=toc-create-your-own-workloads class=nav-link data-scroll-target=#create-your-own-workloads>Create Your Own Workloads!</a></ul><li><a href=#questions id=toc-questions class=nav-link data-scroll-target=#questions>Questions</a></ul></ul></nav></div><main class="content page-columns page-full" id=quarto-document-content><header id=title-block-header class=quarto-title-block><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=../weeks/w6.html>Worksheet 6</a><li class=breadcrumb-item><a href=../labs/process-state.html>Process States in Linux</a></ol></nav></header><section id=process-states-in-linux class="level1 page-columns page-full"><h1>Process States in Linux</h1><p>Niko is staring at an <code>htop</code> screen. The CPU utilization on a client’s server is spiking unpredictably.<p>“Le Mao! I don’t get it. The load is high, but I can’t find a single process that’s misbehaving.”<p>Nini walks over with a cup of tea. “You’re looking at the symptoms, but you don’t understand the language the system is speaking. It reminds me of a story from when I was a junior engineer at Redhat. Let me tell you about it. might help you.”<p>“It was 3 AM,” Nini began, “and I was on call. I got a call from the server room guard: <em>“The server room sounds like a jet engine!”</em> I rushed over to the building. One of our main PostgreSQL database servers was screaming. The cooling fans were at maximum speed, which usually means one thing: <span class=red>something is eating up all the CPU</span><p>“I ssh into the machine and ran <code>htop</code>. This is what I saw.”<div class="quarto-figure quarto-figure-center"><figure class=figure><p><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qoRS5EVy2rD7ToradjWXGw.png class="img-fluid figure-img"><figcaption>Bitcoin mining virus running as database process</figcaption></figure></div><div class="no-row-height column-margin column-container"><div class=margin-aside><p><em>Source: <a href=https://medium.com/@adityaagrawal399/unexpected-cpu-hogs-cryptojacking-threats-and-postgresql-5356df24ac73>Cryptojacking Threats and PostgreSQL</a></em></div></div><p>“My first thought was: <strong>Our database server has been hacked!</strong>”<p>Someone had installed cryptocurrency mining malware. But the question is, <strong>how could we tell this was malicious activity just by looking at the <code>htop</code> output?</strong><p>The answer lies in understanding Linux’s process states.<section id=process-states class="level2 page-columns page-full"><h2 class=anchored data-anchor-id=process-states>Process States</h2><p>To debug any system, you must first understand the fundamentals. This all comes down to the life cycle of a process.<p><strong>Step 1: Read the OSTEP Chapter</strong><p>Read <strong><a href=https://pages.cs.wisc.edu/~remzi/OSTEP/cpu-intro.pdf>Section 4.4 from the OSTEP textbook</a></strong>.<p>After reading, you should be able to answer these questions:<ol type=1><li>What are the three basic process states described in OSTEP?<li>What causes a process to transition from a <em>Running</em> to a <em>Blocked</em> state?</ol><p><strong>Step 2: Compare with Linux’s More Detailed States</strong><p>The three-state model is a good start, but in the real world with Linux, things are more specific. This diagram from performance expert Brendan Gregg is an excellent reference.<div class="quarto-figure quarto-figure-center"><figure class=figure><p><img src=https://www.brendangregg.com/Perf/thread_states.png class="img-fluid figure-img"><figcaption>Process thread from Brendan Gregg</figcaption></figure></div><div class="no-row-height column-margin column-container"><div class=margin-aside><p>Source: Brendan Gregg’s article on <a href=https://www.brendangregg.com/offcpuanalysis.html>off-CPU analysis</a></div></div><p>Linux gives us a more detailed view:<ul><li><strong>R (Running/Runnable):</strong> The process is either currently executing on a CPU or it’s on the run queue, ready and waiting for its turn.<li><strong>S (Interruptible Sleep):</strong> The process is waiting for an event to complete (like network data or a disk read). It can be woken up by a signal.<li><strong>D (Uninterruptible Sleep):</strong> The process is waiting for I/O, typically from a slow or misbehaving device. It cannot be interrupted by signals, which is why you can’t <code>kill -9</code> a process in this state.<li><strong>T (Stopped/Traced):</strong> The process has been stopped, usually by a signal or because it’s being debugged.<li><strong>Z (Zombie):</strong> The process has finished, but its parent process hasn’t collected its exit status yet. It’s dead, but not yet buried.</ul><p>Brendan Gregg defines <strong>Off-CPU Time</strong> as the total time a thread is not running on a CPU. This includes all the time spent waiting for I/O, locks, timers, and so on.<p><strong>Step 3: Back to the Screaming Server</strong><p>Now, let’s apply this knowledge to the <code>htop</code> screenshot from that night. The clues were all there:<ul><li><strong>100% CPU utilization</strong> across all cores, <strong>all the time</strong>. The CPU bars are completely green, meaning the processes are always in the <strong>R (Running/Runnable)</strong> state.<li>The username looked normal (<code>postgres</code>), but the process name was suspicious (<code>MDy7gen</code>).<li>There was <strong>no I/O wait time</strong>. Crypto mining is pure computation. It doesn’t read from disk or wait for the network. It just burns electricity to solve math problems.<li>These malicious processes <strong>never give up the CPU voluntarily</strong>. They are designed to run, run, run.</ul><p>A <strong>normal database server</strong> has a completely different profile:<ul><li>It has a healthy <strong>mix of CPU usage</strong> (for processing queries) and <strong>I/O wait</strong> (for reading/writing data from the disk).<li>Processes frequently transition between <strong>Running (R)</strong> and <strong>Blocked/Sleeping (S)</strong> states.<li>You would see significant time spent in <strong>Interruptible Sleep (S state)</strong> as the database waits for disk operations to complete.<li>CPU utilization would typically be much lower, maybe 20-60%, with short bursts during heavy queries.</ul><p>The server wasn’t just busy; it was abnormally busy in a way that pointed directly to a CPU-bound, non-I/O process. That was the crypto-miner.</section><section id=case-studies-htop-in-the-wild class=level2><h2 class=anchored data-anchor-id=case-studies-htop-in-the-wild>Case Studies: <code>htop</code> in the Wild</h2><p>To get good at this, you need to see more patterns. Let’s analyze some <code>htop</code> screenshots from other production systems.<p>According to the <a href=https://codeahoy.com/2017/01/20/hhtop-explained-visually/>htop visual guide</a>, the colors in the CPU bars mean:<ul><li><strong><span style=color:green>Green</span></strong>: Time spent executing in user mode (normal application code).<li><strong><span style=color:red>Red</span></strong>: Time spent executing in kernel mode (system calls, interrupts, driver code).<li><strong><span style=color:blue>Blue</span></strong>: Time spent on low-priority (niced) user processes.</ul><p>If a process is sleeping to wait for I/O, the CPU is not executing its code at all, so it does not contribute to CPU usage and appear as idle time.<section id=case-1-database-server class=level3><h3 class=anchored data-anchor-id=case-1-database-server>Case 1: Database Server</h3><div class="quarto-figure quarto-figure-center"><figure class=figure><p><img src=https://arrow.apache.org/img/adbc-duckdb/btop.png class="img-fluid figure-img"><figcaption>Database running in data center (source: Fast Streaming Inserts in DuckDB with ADBC)</figcaption></figure></div><p>Look at this <code>btop</code> screenshot. What is the average CPU utilization? Does it match the <em>normal database server pattern</em> we described above? (Notice the mix of green for CPU work and blue/yellow for kernel/system activity).</section><section id=case-2-cpu-bound-hpc-job class=level3><h3 class=anchored data-anchor-id=case-2-cpu-bound-hpc-job>Case 2: CPU-bound HPC Job</h3><p>High-Performance Computing (HPC) workloads are often designed to max out the CPU.<div class="quarto-figure quarto-figure-center"><figure class=figure><p><img src=https://docs.hpc.taltech.ee/pictures/htop-starccm-1node-80core-good_crop.webp class="img-fluid figure-img"><figcaption>CPU Intensive Jobs in HPC (source: <a href=https://docs.hpc.taltech.ee/performance.html>TalTech HPC Centre</a>)</figcaption></figure></div><p>Here, all CPUs are filled with green bars. This is a pure calculation job, similar to the crypto-miner, but this one is legitimate science! Kernel time is minimal, because the job rarely interacts with the OS.</section><section id=case-3-io-bound-hpc-job class=level3><h3 class=anchored data-anchor-id=case-3-io-bound-hpc-job>Case 3: I/O-bound HPC Job</h3><div class="quarto-figure quarto-figure-center"><figure class=figure><p><img src=https://docs.hpc.taltech.ee/pictures/htop-starccm-7node-job_crop.webp class="img-fluid figure-img"><figcaption>I/O Intensive Jobs in HPC (source: <a href=https://docs.hpc.taltech.ee/performance.html>TalTech HPC Centre</a>)</figcaption></figure></div><p>Overall CPU utilization is much lower. Many tasks are in the <em>S</em> (sleep) state (wait for network I/O). Red bars show that a lot of time is in kernel processing shared memory copy or IPC.</section><section id=case-4-parallel-processing-with-data-download class=level3><h3 class=anchored data-anchor-id=case-4-parallel-processing-with-data-download>Case 4: Parallel Processing with Data Download</h3><div class="quarto-figure quarto-figure-center"><figure class=figure><p><img src=images/htop.png class="img-fluid figure-img"><figcaption>Large-scale geoprocessing jobs (src: <a href=https://unix.stackexchange.com/questions/425436/lots-of-red-in-htop-does-that-mean-my-tasks-are-tripping-over-each-other>Stackexchange</a>)</figcaption></figure></div><p>This system is doing heavy computation <em>and</em> heavy network I/O at the same time. Can you identify both types of activity in the <code>htop</code> output? How does this mixed workload compare to the purely CPU-bound or I/O-bound examples?</section><section id=create-your-own-workloads class=level3><h3 class=anchored data-anchor-id=create-your-own-workloads>Create Your Own Workloads!</h3><p>To truly understand these states, create them yourself. Open a terminal and have <code>htop</code> running in another terminal. Run each command and watch what happens to the CPU bars.<div class=sourceCode id=cb1><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id=cb1-1><a href=#cb1-1 aria-hidden=true tabindex=-1></a><span class=co># 1. CPU-intensive task (Watch for solid green bars)</span></span>
<span id=cb1-2><a href=#cb1-2 aria-hidden=true tabindex=-1></a><span class=co># This reads from a source of infinite zeros and throws it away. Pure CPU work.</span></span>
<span id=cb1-3><a href=#cb1-3 aria-hidden=true tabindex=-1></a><span class=fu>dd</span> if=/dev/zero of=/dev/null</span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div><div class=sourceCode id=cb2><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id=cb2-1><a href=#cb2-1 aria-hidden=true tabindex=-1></a><span class=co># 2. I/O-intensive task (CPU usage will be low, process in 'S' or 'D' state)</span></span>
<span id=cb2-2><a href=#cb2-2 aria-hidden=true tabindex=-1></a><span class=co># This searches your entire filesystem. Most of the time is spent waiting for the disk.</span></span>
<span id=cb2-3><a href=#cb2-3 aria-hidden=true tabindex=-1></a><span class=fu>find</span> / <span class=at>-name</span> <span class=st>"*.txt"</span> <span class=dv>2</span><span class=op>&gt;</span>/dev/null</span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div><div class=sourceCode id=cb3><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id=cb3-1><a href=#cb3-1 aria-hidden=true tabindex=-1></a><span class=co># 3. Mixed workload</span></span>
<span id=cb3-2><a href=#cb3-2 aria-hidden=true tabindex=-1></a><span class=co># This reads files from the disk (I/O) and compresses them (CPU).</span></span>
<span id=cb3-3><a href=#cb3-3 aria-hidden=true tabindex=-1></a><span class=fu>tar</span> <span class=at>-czf</span> large_archive.tar.gz /usr/share/</span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div><hr><p>Nini finishes her story. “So, by understanding the process states, I knew exactly what kind of problem I was dealing with. I found out the victim server, killed the bitcoin mining. It was a long night, but a good lesson.”<p>Niko: “Boss, you explained better than <em><span class=red>Le Chat GPT</span></em>!</section></section><section id=questions class=level2><h2 class=anchored data-anchor-id=questions>Questions</h2><section id=q1 class=level4><h4 class=anchored data-anchor-id=q1><strong>Q1</strong></h4><div class=sourceCode id=cb4><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id=cb4-1><a href=#cb4-1 aria-hidden=true tabindex=-1></a><span class=pp>#include </span><span class=im>&lt;unistd.h&gt;</span></span>
<span id=cb4-2><a href=#cb4-2 aria-hidden=true tabindex=-1></a><span class=pp>#include </span><span class=im>&lt;stdio.h&gt;</span></span>
<span id=cb4-3><a href=#cb4-3 aria-hidden=true tabindex=-1></a><span class=pp>#include </span><span class=im>&lt;stdlib.h&gt;</span></span>
<span id=cb4-4><a href=#cb4-4 aria-hidden=true tabindex=-1></a><span class=pp>#include </span><span class=im>&lt;time.h&gt;</span></span>
<span id=cb4-5><a href=#cb4-5 aria-hidden=true tabindex=-1></a><span class=dt>int</span> main<span class=op>()</span> <span class=op>{</span></span>
<span id=cb4-6><a href=#cb4-6 aria-hidden=true tabindex=-1></a>    srand<span class=op>(</span>time<span class=op>(</span>NULL<span class=op>));</span></span>
<span id=cb4-7><a href=#cb4-7 aria-hidden=true tabindex=-1></a>    <span class=dt>int</span> i<span class=op>,</span> count <span class=op>=</span> <span class=dv>0</span><span class=op>,</span> n <span class=op>=</span> <span class=fl>1e9</span><span class=op>;</span></span>
<span id=cb4-8><a href=#cb4-8 aria-hidden=true tabindex=-1></a>    <span class=dt>double</span> x<span class=op>,</span> y<span class=op>,</span> z<span class=op>,</span> pi<span class=op>;</span></span>
<span id=cb4-9><a href=#cb4-9 aria-hidden=true tabindex=-1></a>    <span class=cf>for</span><span class=op>(</span>i <span class=op>=</span> <span class=dv>0</span><span class=op>;</span> i <span class=op>&lt;</span> n<span class=op>;</span> <span class=op>++</span>i<span class=op>)</span> <span class=op>{</span></span>
<span id=cb4-10><a href=#cb4-10 aria-hidden=true tabindex=-1></a>        x <span class=op>=</span> <span class=op>(</span><span class=dt>double</span><span class=op>)</span>rand<span class=op>()</span> <span class=op>/</span> RAND_MAX<span class=op>;</span></span>
<span id=cb4-11><a href=#cb4-11 aria-hidden=true tabindex=-1></a>        y <span class=op>=</span> <span class=op>(</span><span class=dt>double</span><span class=op>)</span>rand<span class=op>()</span> <span class=op>/</span> RAND_MAX<span class=op>;</span></span>
<span id=cb4-12><a href=#cb4-12 aria-hidden=true tabindex=-1></a>        z <span class=op>=</span> x <span class=op>*</span> x <span class=op>+</span> y <span class=op>*</span> y<span class=op>;</span></span>
<span id=cb4-13><a href=#cb4-13 aria-hidden=true tabindex=-1></a>        <span class=cf>if</span><span class=op>(</span> z <span class=op>&lt;=</span> <span class=dv>1</span> <span class=op>)</span> count<span class=op>++;</span></span>
<span id=cb4-14><a href=#cb4-14 aria-hidden=true tabindex=-1></a>    <span class=op>}</span></span>
<span id=cb4-15><a href=#cb4-15 aria-hidden=true tabindex=-1></a></span>
<span id=cb4-16><a href=#cb4-16 aria-hidden=true tabindex=-1></a>    pi <span class=op>=</span> <span class=op>(</span><span class=dt>double</span><span class=op>)</span> count <span class=op>/</span> n <span class=op>*</span> <span class=dv>4</span><span class=op>;</span></span>
<span id=cb4-17><a href=#cb4-17 aria-hidden=true tabindex=-1></a>    printf<span class=op>(</span><span class=st>"Approximate PI = </span><span class=sc>%g</span><span class=st>"</span><span class=op>,</span> pi<span class=op>);</span></span>
<span id=cb4-18><a href=#cb4-18 aria-hidden=true tabindex=-1></a><span class=op>}</span></span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div><p>Is this CPU-bound or I/O bound? Which color will you most likely see for this process’s CPU bar?</p></section><section id=q2 class=level4><h4 class=anchored data-anchor-id=q2><strong>Q2</strong></h4><div class=sourceCode id=cb5><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id=cb5-1><a href=#cb5-1 aria-hidden=true tabindex=-1></a><span class=pp>#include </span><span class=im>&lt;unistd.h&gt;</span></span>
<span id=cb5-2><a href=#cb5-2 aria-hidden=true tabindex=-1></a><span class=pp>#include </span><span class=im>&lt;stdlib.h&gt;</span></span>
<span id=cb5-3><a href=#cb5-3 aria-hidden=true tabindex=-1></a><span class=pp>#include </span><span class=im>&lt;stdio.h&gt;</span></span>
<span id=cb5-4><a href=#cb5-4 aria-hidden=true tabindex=-1></a></span>
<span id=cb5-5><a href=#cb5-5 aria-hidden=true tabindex=-1></a><span class=dt>int</span> main<span class=op>(</span><span class=dt>void</span><span class=op>)</span></span>
<span id=cb5-6><a href=#cb5-6 aria-hidden=true tabindex=-1></a><span class=op>{</span></span>
<span id=cb5-7><a href=#cb5-7 aria-hidden=true tabindex=-1></a>    pid_t pid <span class=op>=</span> fork<span class=op>();</span></span>
<span id=cb5-8><a href=#cb5-8 aria-hidden=true tabindex=-1></a>    <span class=cf>if</span> <span class=op>(</span>pid <span class=op>==</span> <span class=dv>0</span><span class=op>)</span> <span class=op>{</span> <span class=co>/* Child */</span></span>
<span id=cb5-9><a href=#cb5-9 aria-hidden=true tabindex=-1></a>        printf<span class=op>(</span><span class=st>"Child PID: </span><span class=sc>%d\n</span><span class=st>"</span><span class=op>,</span> getpid<span class=op>());</span></span>
<span id=cb5-10><a href=#cb5-10 aria-hidden=true tabindex=-1></a>        _exit<span class=op>(</span><span class=dv>0</span><span class=op>);</span></span>
<span id=cb5-11><a href=#cb5-11 aria-hidden=true tabindex=-1></a>    <span class=op>}</span></span>
<span id=cb5-12><a href=#cb5-12 aria-hidden=true tabindex=-1></a></span>
<span id=cb5-13><a href=#cb5-13 aria-hidden=true tabindex=-1></a>    printf<span class=op>(</span><span class=st>"Parent PID: </span><span class=sc>%d\n</span><span class=st>"</span><span class=op>,</span> getpid<span class=op>());</span></span>
<span id=cb5-14><a href=#cb5-14 aria-hidden=true tabindex=-1></a>    sleep<span class=op>(</span><span class=dv>60</span><span class=op>);</span></span>
<span id=cb5-15><a href=#cb5-15 aria-hidden=true tabindex=-1></a>    <span class=cf>return</span> <span class=dv>0</span><span class=op>;</span></span>
<span id=cb5-16><a href=#cb5-16 aria-hidden=true tabindex=-1></a><span class=op>}</span></span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div><div class=sourceCode id=cb6><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id=cb6-1><a href=#cb6-1 aria-hidden=true tabindex=-1></a><span class=fu>gcc</span> <span class=at>-o</span> sleep sleep.c</span>
<span id=cb6-2><a href=#cb6-2 aria-hidden=true tabindex=-1></a><span class=ex>./sleep</span> <span class=kw>&amp;</span></span>
<span id=cb6-3><a href=#cb6-3 aria-hidden=true tabindex=-1></a><span class=fu>ps</span> <span class=at>-o</span> pid,ppid,state,cmd <span class=kw>|</span> <span class=fu>grep</span> sleep</span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div><p>What is the state (single character) of the <strong>CHILD</strong> process?</p></section><section id=q3 class=level4><h4 class=anchored data-anchor-id=q3><strong>Q3</strong></h4><p>Please look at htop screenshot of <a href=https://unix.stackexchange.com/questions/769100/kworker-causes-high-cpu-and-ram-consumption>the problematic server</a><p>The system is dominated by the kernel’s <code>kswapd0</code> to squeeze out free memory. There might be a lot of <em>page faults</em> going on. (電腦記憶體被用爆，kernel 哀嚎 …)<p>What is most likely the process state these processes are in? (single character)</p></section><section id=q4-bonus class=level4><h4 class=anchored data-anchor-id=q4-bonus><strong>Q4</strong> (Bonus)</h4><p>How do you create a situation where the kernel itself is using 100% of every core? Can you show me an <code>htop</code> screenshot where every CPU bar is solid <strong>red</strong>. This means the kernel is doing all the work, and your user-space programs are mostly waiting?</p></section></section></section><a onclick="return window.scrollTo(0,0),!1" role=button id=quarto-back-to-top><i class="bi bi-arrow-up"></i> Back to top</a></main><script id=quarto-html-after-body>window.document.addEventListener("DOMContentLoaded",function(){const j="",c=new window.AnchorJS;c.options={placement:"right",icon:j},c.add(".anchored");const v=e=>{for(const t of e.classList)if(t.startsWith("code-annotation-"))return!0;return!1},p=function(e){const t=e.trigger;t.blur(),t.classList.add("code-copy-button-checked");var s=t.getAttribute("title");t.setAttribute("title","Copied!");let n;window.bootstrap&&(t.setAttribute("data-bs-toggle","tooltip"),t.setAttribute("data-bs-placement","left"),t.setAttribute("data-bs-title","Copied!"),n=new bootstrap.Tooltip(t,{trigger:"manual",customClass:"code-copy-button-tooltip",offset:[0,-8]}),n.show()),setTimeout(function(){n&&(n.hide(),t.removeAttribute("data-bs-title"),t.removeAttribute("data-bs-toggle"),t.removeAttribute("data-bs-placement")),t.setAttribute("title",s),t.classList.remove("code-copy-button-checked")},1e3),e.clearSelection()},m=function(e){const t=e.previousElementSibling.cloneNode(!0);for(const e of t.children)v(e)&&e.remove();return t.innerText},b=new window.ClipboardJS(".code-copy-button:not([data-in-quarto-modal])",{text:m});if(b.on("success",p),window.document.getElementById("quarto-embedded-source-code-modal")){const e=new window.ClipboardJS(".code-copy-button[data-in-quarto-modal]",{text:m,container:window.document.getElementById("quarto-embedded-source-code-modal")});e.on("success",p)}for(var s,g=new RegExp(/^(?:http|https):\/\/localhost:?[0-9]*\//),x=new RegExp(/^mailto:/),O=new RegExp("/"+window.location.host+"/"),w=e=>O.test(e)||g.test(e)||x.test(e),u=window.document.querySelectorAll("a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)"),t=0;t<u.length;t++){const e=u[t];w(e.href)||(e.dataset.originalHref!==0[0]&&(e.href=e.dataset.originalHref),e.setAttribute("target","_blank"),e.getAttribute("rel")===null&&e.setAttribute("rel","noopener"),e.classList.add("external"))}function i(e,t,n,s){const o={allowHTML:!0,maxWidth:500,delay:100,arrow:!1,appendTo:function(e){return e.parentElement},interactive:!0,interactiveBorder:10,theme:"quarto",placement:"bottom-start"};t&&(o.content=t),n&&(o.onTrigger=n),s&&(o.onUntrigger=s),window.tippy(e,o)}const f=window.document.querySelectorAll('a[role="doc-noteref"]');for(t=0;t<f.length;t++){const e=f[t];i(e,function(){let t=e.getAttribute("data-footnote-href")||e.getAttribute("href");try{t=new URL(t).hash}catch{}const s=t.replace(/^#\/?/,""),n=window.document.getElementById(s);return n?n.innerHTML:""})}const r=window.document.querySelectorAll("a.quarto-xref"),o=(e,t)=>{const n=e=>{if(e.classList.remove("page-full","page-columns"),e.children)for(const t of e.children)n(t)};if(n(t),e===null||e.startsWith("sec-")){const e=document.createElement("div");if(t.children&&t.children.length>2){e.appendChild(t.children[0].cloneNode(!0));for(let n=1;n<t.children.length;n++){const s=t.children[n];if(s.tagName==="P"&&s.innerText==="")continue;e.appendChild(s.cloneNode(!0));break}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(e),e.innerHTML}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(t),t.innerHTML}else{const e=t.querySelector("a.anchorjs-link");return e&&e.remove(),window.Quarto?.typesetMath&&window.Quarto.typesetMath(t),t.classList.contains("callout")?t.outerHTML:t.innerHTML}};for(t=0;t<r.length;t++){const e=r[t];i(e,0[0],function(t){t.disable();let n=e.getAttribute("href"),s=0[0];if(n.startsWith("#"))s=n;else try{s=new URL(n).hash}catch{}if(s){const e=s.replace(/^#\/?/,""),i=window.document.getElementById(e);if(i!==null)try{const n=o(e,i.cloneNode(!0));t.setContent(n)}finally{t.enable(),t.show()}else fetch(n.split("#")[0]).then(e=>e.text()).then(n=>{const i=new DOMParser,a=i.parseFromString(n,"text/html"),s=a.getElementById(e);if(s!==null){const n=o(e,s);t.setContent(n)}}).finally(()=>{t.enable(),t.show()})}else fetch(n).then(e=>e.text()).then(e=>{const s=new DOMParser,i=s.parseFromString(e,"text/html"),n=i.querySelector("main.content");if(n!==null){n.children.length>0&&n.children[0].tagName==="HEADER"&&n.children[0].remove();const e=o(null,n);t.setContent(e)}}).finally(()=>{t.enable(),t.show()})},function(){})}let n;const h=(e,t)=>{let n='data-code-cell="'+e+'"',s='data-code-annotation="'+t+'"';const o="span["+n+"]["+s+"]";return o},a=e=>{const d=window.document,i=e.getAttribute("data-target-cell"),r=e.getAttribute("data-target-annotation"),c=window.document.querySelector(h(i,r)),l=c.getAttribute("data-code-lines").split(","),t=l.map(e=>i+"-"+e);let s=null,o=null,a=null;if(t.length>0){const r=window.document.getElementById(t[0]);if(s=r.offsetTop,o=r.offsetHeight,a=r.parentElement.parentElement,t.length>1){const e=window.document.getElementById(t[t.length-1]),n=e.offsetTop+e.offsetHeight;o=n-s}if(s!==null&&o!==null&&a!==null){let e=window.document.getElementById("code-annotation-line-highlight");e===null&&(e=window.document.createElement("div"),e.setAttribute("id","code-annotation-line-highlight"),e.style.position="absolute",a.appendChild(e)),e.style.top=s-2+"px",e.style.height=o+4+"px",e.style.left=0;let t=window.document.getElementById("code-annotation-line-highlight-gutter");if(t===null){t=window.document.createElement("div"),t.setAttribute("id","code-annotation-line-highlight-gutter"),t.style.position="absolute";const e=window.document.getElementById(i),n=e.querySelector(".code-annotation-gutter");n.appendChild(t)}t.style.top=s-2+"px",t.style.height=o+4+"px"}n=e}},y=()=>{const e=["code-annotation-line-highlight","code-annotation-line-highlight-gutter"];e.forEach(e=>{const t=window.document.getElementById(e);t&&t.remove()}),n=0[0]};window.addEventListener("resize",_(()=>{elRect=0[0],n&&a(n)},10));function _(e,t){let s=!1,n;return(...o)=>{s?(n&&clearTimeout(n),n=setTimeout(()=>{e.apply(this,o),n=s=!1},t)):(e.apply(this,o),s=!0)}}const d=window.document.querySelectorAll(".code-annotation-anchor");for(let e=0;e<d.length;e++){const t=d[e],n=t.getAttribute("data-target-cell"),s=t.getAttribute("data-target-annotation"),o=()=>{const e=window.document.querySelector(h(n,s));if(e){const t=e.cloneNode(!0);return t.classList.add("code-annotation-tip-content"),t.outerHTML}},i={allowHTML:!0,content:o,onShow:e=>{a(e.reference),e.reference.classList.add("code-annotation-active"),window.tippy.hideAll()},onHide:e=>{y(),e.reference.classList.remove("code-annotation-active")},maxWidth:300,delay:[50,0],duration:[200,0],offset:[5,10],arrow:!0,appendTo:function(e){return e.parentElement.parentElement.parentElement},interactive:!0,interactiveBorder:10,theme:"quarto",placement:"right",popperOptions:{modifiers:[{name:"flip",options:{flipVariations:!1,allowedAutoPlacements:["right"],fallbackPlacements:["right","top","top-start","top-end","bottom","bottom-start","bottom-end","left"]}},{name:"preventOverflow",options:{mainAxis:!1,altAxis:!1}}]}};window.tippy(t,i)}const l=e=>{const t=e.parentElement;if(t){const n=t.dataset.cites;return n?{el:e,cites:n.split(" ")}:l(e.parentElement)}else return 0[0]};for(s=window.document.querySelectorAll('a[role="doc-biblioref"]'),t=0;t<s.length;t++){const n=s[t],e=l(n);e&&i(e.el,function(){var t=window.document.createElement("div");return e.cites.forEach(function(e){var s,n=window.document.createElement("div");n.classList.add("hanging-indent"),n.classList.add("csl-entry"),s=window.document.getElementById("ref-"+e),s&&(n.innerHTML=s.innerHTML),t.appendChild(n)}),t.innerHTML})}})</script></div><footer class=footer><div class=nav-footer><div class=nav-footer-left><p><img id=footer-cat-left src=../images/cat-left.png alt="Cat Left"></div><div class=nav-footer-center><p><span id=footer-center>Made with ❤️ by Tony, (CC&nbsp;BY&nbsp;4.0)<br><span style=font-size:8px>Cat source: Freepik and ChatGPT</span></span></div><div class=nav-footer-right><p><img id=footer-cat-right src=../images/cat-right.png alt="Cat Right"></div></div></footer>