<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=en xml:lang=en><meta charset=utf-8><meta name=generator content="quarto-1.7.33"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes"><title>ipod ‚Äì Operating System (2025 Fall)</title><style>code{white-space:pre-wrap}span.smallcaps{font-variant:small-caps}div.columns{display:flex;gap:min(4vw,1.5em)}div.column{flex:auto;overflow-x:auto}div.hanging-indent{margin-left:1.5em;text-indent:-1.5em}ul.task-list{list-style:none}ul.task-list li input[type=checkbox]{width:.8em;margin:0 .8em .2em -1em;vertical-align:middle}</style><script src=../site_libs/quarto-nav/quarto-nav.js></script><script src=../site_libs/clipboard/clipboard.min.js></script><script src=../site_libs/quarto-search/autocomplete.umd.js></script><script src=../site_libs/quarto-search/fuse.min.js></script><script src=../site_libs/quarto-search/quarto-search.js></script><meta name=quarto:offset content="../"><link href=../images/orange.png rel=icon type=image/png><script src=../site_libs/quarto-html/quarto.js type=module></script><script src=../site_libs/quarto-html/tabsets/tabsets.js type=module></script><script src=../site_libs/quarto-html/popper.min.js></script><script src=../site_libs/quarto-html/tippy.umd.min.js></script><script src=../site_libs/quarto-html/anchor.min.js></script><link href=../site_libs/quarto-html/tippy.css rel=stylesheet><link href=../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css rel=stylesheet id=quarto-text-highlighting-styles><script src=../site_libs/bootstrap/bootstrap.min.js></script><link href=../site_libs/bootstrap/bootstrap-icons.css rel=stylesheet><link href=../site_libs/bootstrap/bootstrap-a3d6f4078ec9f2632a80ad631344d584.min.css rel=stylesheet append-hash=true id=quarto-bootstrap data-mode=light><script id=quarto-search-options type=application/json>{"location":"navbar","copy-button":false,"collapse-after":3,"panel-placement":"end","type":"overlay","limit":50,"keyboard-shortcut":["f","/","s"],"show-item-context":false,"language":{"search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search"}}</script><body class="nav-sidebar docked nav-fixed slimcontent quarto-light"><div id=quarto-search-results></div><header id=quarto-header class="headroom fixed-top"><nav class="navbar navbar-expand-lg" data-bs-theme=dark><div class="navbar-container container-fluid"><div class="navbar-brand-container mx-auto"><a class=navbar-brand href=../index.html><span class=navbar-title>Operating System (2025 Fall)</span></a></div><div id=quarto-search title=Search></div><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarCollapse aria-controls=navbarCollapse role=menu aria-expanded=false aria-label="Toggle navigation" onclick=window.quartoToggleHeadroom&&window.quartoToggleHeadroom()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarCollapse><ul class="navbar-nav navbar-nav-scroll me-auto"><li class=nav-item><a class="nav-link active" href=../index.html aria-current=page><span class=menu-text>Home</span></a><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=nav-menu-handouts role=link data-bs-toggle=dropdown aria-expanded=false><span class=menu-text>Handouts</span></a><ul class=dropdown-menu aria-labelledby=nav-menu-handouts><li><a class=dropdown-item href=../handouts/env_setup.html><span class=dropdown-text>Environment Setup</span></a><li><a class=dropdown-item href=../handouts/unix.html><span class=dropdown-text>Unix</span></a><li><a class=dropdown-item href=../handouts/privilege.html><span class=dropdown-text>Privilege</span></a><li><a class=dropdown-item href=../handouts/scheduler.html><span class=dropdown-text>Scheduler</span></a><li><a class=dropdown-item href=../handouts/buffercache.html><span class=dropdown-text>Buffer Cache</span></a><li><a class=dropdown-item href=../handouts/vm-page-size.html><span class=dropdown-text>Virtual Memory: Page Size</span></a></ul><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=nav-menu-labs role=link data-bs-toggle=dropdown aria-expanded=false><span class=menu-text>Labs</span></a><ul class=dropdown-menu aria-labelledby=nav-menu-labs><li><a class=dropdown-item href=../labs/mini-cloud.html><span class=dropdown-text>Mini Cloud</span></a><li><a class=dropdown-item href=../labs/linking.html><span class=dropdown-text>Linking</span></a><li><a class=dropdown-item href=../labs/process-creation.html><span class=dropdown-text>Process Creation</span></a><li><a class=dropdown-item href=../labs/process-state.html><span class=dropdown-text>Process State</span></a><li><a class=dropdown-item href=../labs/process-address-space.html><span class=dropdown-text>Process Address Space</span></a><li><hr class=dropdown-divider><li><a class=dropdown-item href=../labs/path-traversal.html><span class=dropdown-text>Path Traversal</span></a><li><a class=dropdown-item href=../labs/pipe-passwords.html><span class=dropdown-text>Pipe Passwords</span></a><li><a class=dropdown-item href=../labs/pipe-dup.html><span class=dropdown-text>Pipe and dup()</span></a><li><a class=dropdown-item href=../labs/pipe-pingpong.html><span class=dropdown-text>Pipe Ping-Pong</span></a><li><a class=dropdown-item href=../labs/fifo.html><span class=dropdown-text>FIFO (named pipe)</span></a><li><hr class=dropdown-divider><li><a class=dropdown-item href=../labs/cat.html><span class=dropdown-text>Cat</span></a><li><hr class=dropdown-divider><li><a class=dropdown-item href=../labs/xv6-syscall.html><span class=dropdown-text>xv6 System Call Tracing</span></a></ul><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=nav-menu-admin role=link data-bs-toggle=dropdown aria-expanded=false><span class=menu-text>Admin</span></a><ul class=dropdown-menu aria-labelledby=nav-menu-admin><li><a class=dropdown-item href=../admin/policies.html><span class=dropdown-text>Policies</span></a><li><a class=dropdown-item href=../admin/explore.html><span class=dropdown-text>Exploratory Projects</span></a><li><a class=dropdown-item href=../admin/waitbutwhy.html><span class=dropdown-text>SD1‚Üì (ÁáíËõã‰∏Ä‰∏ã)</span></a></ul></ul><ul class="navbar-nav navbar-nav-scroll ms-auto"><li class="nav-item compact"><a class=nav-link href="https://elearn.nthu.edu.tw/course/view.php?id=38873"><i class="bi bi-globe" role=img></i><span class=menu-text></span></a></ul></div><div class=quarto-navbar-tools></div></div></nav><nav class=quarto-secondary-nav><div class="container-fluid d-flex"><button type=button class="quarto-btn-toggle btn" data-bs-toggle=collapse role=button data-bs-target=.quarto-sidebar-collapse-item aria-controls=quarto-sidebar aria-expanded=false aria-label="Toggle sidebar navigation" onclick=window.quartoToggleHeadroom&&window.quartoToggleHeadroom()>
<i class="bi bi-layout-text-sidebar-reverse"></i></button><nav class=quarto-page-breadcrumbs aria-label=breadcrumb><ol class=breadcrumb></ol></nav><a class=flex-grow-1 role=navigation data-bs-toggle=collapse data-bs-target=.quarto-sidebar-collapse-item aria-controls=quarto-sidebar aria-expanded=false aria-label="Toggle sidebar navigation" onclick=window.quartoToggleHeadroom&&window.quartoToggleHeadroom()></a><button type=button class="btn quarto-search-button" aria-label=Search onclick=window.quartoOpenSearch()>
<i class="bi bi-search"></i></button></div></nav></header><div id=quarto-content class="quarto-container page-columns page-rows-contents page-layout-article page-navbar"><nav id=quarto-sidebar class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center"><div class=sidebar-search><div id=quarto-search title=Search></div></div></div><div class=sidebar-menu-container><ul class="list-unstyled mt-1"><li class=sidebar-item><div class=sidebar-item-container><a href=../index.html class="sidebar-item-text sidebar-link"><span class=menu-text>OS 2025 Fall</span></a></div><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w2.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 2</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-1 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-1 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/env_setup.html class="sidebar-item-text sidebar-link"><span class=menu-text>Environment setup</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w3.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 3</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-2 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-2 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/unix.html class="sidebar-item-text sidebar-link"><span class=menu-text>Unix Philosophy</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/mini-cloud.html class="sidebar-item-text sidebar-link"><span class=menu-text>Your First Week in OS Journey</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/process-creation.html class="sidebar-item-text sidebar-link"><span class=menu-text><code>fork()</code>/<code>exec()</code></span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w4.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 4</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-3 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-3 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/privilege.html class="sidebar-item-text sidebar-link"><span class=menu-text>Privilege</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/path-traversal.html class="sidebar-item-text sidebar-link"><span class=menu-text>Lab: Path Traversal Attack</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/process-address-space.html class="sidebar-item-text sidebar-link"><span class=menu-text>Address Space Layout</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/linking.html class="sidebar-item-text sidebar-link"><span class=menu-text>Static vs Dynamic Linking</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w5.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 5</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-4 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-4 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/pipe-passwords.html class="sidebar-item-text sidebar-link"><span class=menu-text>Parallelizing Rainbow Table Lookup with Pipes</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/pipe-dup.html class="sidebar-item-text sidebar-link"><span class=menu-text>Pipes, Redirection, and File Descriptors</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/fifo.html class="sidebar-item-text sidebar-link"><span class=menu-text>FIFO (named pipe)</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w6.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 6</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-5 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-5 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/scheduler.html class="sidebar-item-text sidebar-link"><span class=menu-text>Schedulers</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/process-state.html class="sidebar-item-text sidebar-link"><span class=menu-text>Process States in Linux</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/pipe-pingpong.html class="sidebar-item-text sidebar-link"><span class=menu-text>Pipe Pingpong</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w8.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 8</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-6 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-6 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/buffercache.html class="sidebar-item-text sidebar-link"><span class=menu-text>Caching and Buffering</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/cat.html class="sidebar-item-text sidebar-link"><span class=menu-text>How <code>cat</code> works?</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w9.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 9</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-7 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-7 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/xv6-intro.html class="sidebar-item-text sidebar-link"><span class=menu-text>Introduction to xv6</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/xv6-gdb.html class="sidebar-item-text sidebar-link"><span class=menu-text>GNU Debugger Tutorial</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/xv6-syscall.html class="sidebar-item-text sidebar-link"><span class=menu-text>xv6 Syscall Tracing</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w10.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 10</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-8 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-8 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/vm-page-size.html class="sidebar-item-text sidebar-link"><span class=menu-text>Why Android Moved to 16KB Pages</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w11.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 11</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-9 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-9 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/xv6-forkbomb.html class="sidebar-item-text sidebar-link"><span class=menu-text>xv6 Fork Bomb</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w12.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 12</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-10 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-10 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/event-driven-io.html class="sidebar-item-text sidebar-link"><span class=menu-text>Event-Driven I/O</span></a></div></ul></ul></div></nav><div id=quarto-sidebar-glass class=quarto-sidebar-collapse-item data-bs-toggle=collapse data-bs-target=.quarto-sidebar-collapse-item></div><div id=quarto-margin-sidebar class="sidebar margin-sidebar"><nav id=TOC role=doc-toc class=toc-active><h2 id=toc-title>On this page</h2><ul><li><a href=#the-stories-of-three-file-systems id=toc-the-stories-of-three-file-systems class="nav-link active" data-scroll-target=#the-stories-of-three-file-systems>The stories of three file systems</a><ul class=collapse><li><a href=#the-ipod id=toc-the-ipod class=nav-link data-scroll-target=#the-ipod>The iPod</a><ul class=collapse><li><a href=#the-portable-music-problem id=toc-the-portable-music-problem class=nav-link data-scroll-target=#the-portable-music-problem>The Portable Music Problem</a><li><a href=#songs-in-your-pocket id=toc-songs-in-your-pocket class=nav-link data-scroll-target=#songs-in-your-pocket>‚Äú1,000 Songs in Your Pocket‚Äù</a><li><a href=#fat32 id=toc-fat32 class=nav-link data-scroll-target=#fat32>FAT32</a><li><a href=#why-bother-with-hfs id=toc-why-bother-with-hfs class=nav-link data-scroll-target=#why-bother-with-hfs>Why Bother with HFS+?</a></ul><li><a href=#reiserfs id=toc-reiserfs class=nav-link data-scroll-target=#reiserfs>ReiserFS</a><ul class=collapse><li><a href=#tail-packing id=toc-tail-packing class=nav-link data-scroll-target=#tail-packing>Tail Packing</a><li><a href=#bus-factor-1 id=toc-bus-factor-1 class=nav-link data-scroll-target=#bus-factor-1>Bus factor = 1</a></ul><li><a href=#bring-home-lessons id=toc-bring-home-lessons class=nav-link data-scroll-target=#bring-home-lessons>Bring-home lessons</a><li><a href=#want-to-learn-more id=toc-want-to-learn-more class=nav-link data-scroll-target=#want-to-learn-more>Want to Learn More?</a></ul></ul></nav></div><main class="content page-columns page-full" id=quarto-document-content><header id=title-block-header class=quarto-title-block></header><section id=the-stories-of-three-file-systems class="level1 page-columns page-full"><h1>The stories of three file systems</h1><p>There are many many kinds of file systems out there. Engineers must make tradeoffs between performance, compatibility, and human factors. Today, let‚Äôs go back to 2001 (slightly before you were born!?) to look at <strong>Apple iPod</strong>‚Äôs file-system and the sad story of ReiserFS.<section id=the-ipod class="level2 page-columns page-full"><h2 class=anchored data-anchor-id=the-ipod>The iPod</h2><p>Today, listening to music means streaming from Spotify or Youtube. Storage is cheap and big. You can buy a 256GB microSD card at a convenience store for under 500 NTD. But in 2001, the digital storage landscape looked completely different.<section id=the-portable-music-problem class=level3><h3 class=anchored data-anchor-id=the-portable-music-problem>The Portable Music Problem</h3><p>In 1997, people began to carry bulky CD player to the beach (+ multiple CDs in a case). <a href=https://en.wikipedia.org/wiki/Walkman>Sony‚Äôs ‚ÄúCD Walkman‚Äù</a> was a cool new toy. Listening to music was no longer an indoor activity.<div class="quarto-figure quarto-figure-center" style=max-width:240px;float:right;margin-left:30px><figure class=figure><p><img src=https://upload.wikimedia.org/wikipedia/commons/d/d1/Sony_CD_Walkman_D-EJ985_rear.jpg class="img-fluid figure-img"><figcaption>Sony Walkman in 2002</figcaption></figure></div><p>Flash memory in 2001 was expensive and tiny. The first USB flash drives (<a href=https://jccotp4israel.wordpress.com/2011/02/08/israeli-company-invented-the-first-usb-flash-drive-named-%E2%80%9Cdiskonkey%E2%80%9D/>invented in Israel</a>) offered only 8MB of storage. Portable music players based on flash memory could store about a dozen songs at most. Flash memory had a big advantage though: it was solid-state, meaning no moving parts. You could drop a flash-based player and it would keep working.<p>Hard drives offered far more capacity but came with serious drawbacks. A mechanical hard drive contains spinning magnetic platters and a read/write head that moves across them. If you dropped a hard drive or shook it while it was spinning, the head could crash into the platter and destroy data. No company was able to produce a truly portable music player with a hard drive that could survive being carried in a pocket.</section><section id=songs-in-your-pocket class="level3 page-columns page-full"><h3 class=anchored data-anchor-id=songs-in-your-pocket>‚Äú1,000 Songs in Your Pocket‚Äù</h3><p>In 2001, Steve Jobs stood on stage and pulled out a strange device from the pocket of his jeans, and said: <a href=https://influence.digital/posts/1000-songs-in-your-pocket><strong>‚Äú1,000 songs in your pocket.‚Äù</strong></a><div class="quarto-figure quarto-figure-center" style=max-width:360px;float:right;margin-left:30px><figure class=figure><p><img src=https://influence.digital/storage/01JCGJ0M7Y3M8Z4QWVMPCVKRME.jpg class="img-fluid figure-img"><figcaption>macrumours.com</figcaption></figure></div><div class="no-row-height column-margin column-container"><div class=margin-aside><p><a href="https://www.youtube.com/watch?v=RKBfnyeXMLQ">Apple iPod Classic Tear-down! See the hard drive inside! Amazing technology!</a></div></div><p>This was the original iPod. Apple used a tiny 5GB Toshiba mechanical hard drive. The drive was fragile. Drop the iPod while it was playing and you could kill it. But Apple solved this with clever engineering: the iPod would spin up the drive, rapidly load about 30MB of music into RAM, then immediately stop the spinning to minimize the vulnerability. As long as the drive was not actively spinning, the device could survive some shocks.<p>That ‚Äú1,000 songs in your pocket‚Äù slogan was quite impressive in 2001. For the first time, you could carry your entire music library without a stack of CDs or a bulky player. The iPod sold over 400 million units and lay the foundation for iPhone, which launched in 2007.<p>But there was a problem. The iPod initially shipped formatted with the <strong>HFS+</strong> file-system (same as Mac OS X). At that time, Windows computers represented 97% of the market, and Windows could not recognize HFS+. Apple needed a solution that worked for both Mac and Windows users without maintaining two separate product lines.</section><section id=fat32 class=level3><h3 class=anchored data-anchor-id=fat32>FAT32</h3><p>Apple was forced to adopt <strong>FAT32</strong> (File Allocation Table 32-bit), a file system that dates back to 1996 as an extension of the much older FAT system from MS-DOS. Let‚Äôs contrast FAT32 with ext2, which we studied in lecture.<p>In ext2, each file has an inode that contains metadata (permissions, timestamps, size) and pointers to data blocks. The inodes are stored in a dedicated inode table, and you locate a file by first finding its inode number from a directory entry, then reading that inode to get the block locations.<div class="quarto-figure quarto-figure-center" style=max-width:240px;float:right;margin-left:30px><figure class=figure><p><img src=https://www.researchgate.net/profile/Theo-Haerder/publication/221103086/figure/fig1/AS:393977690902550@1470943009845/The-file-allocation-table-in-the-FAT-file-system-resembles-a-linked-list-that-has-to-be.png class="img-fluid figure-img"><figcaption>source: Theo H√§rder</figcaption></figure></div><p>FAT32 works differently. Instead of a separate inode table, FAT32 stores all its block allocation information in a single large table at the beginning of the disk called the <strong>File Allocation Table</strong> (FAT). Here is how it works:<ol type=1><li><strong>The disk is divided into clusters</strong> (similar to blocks in ext2). A cluster is typically 4KB or larger.<li><strong>The FAT is an array</strong> where each entry corresponds to one cluster on the disk. If your disk has 1 million clusters, the FAT has 1 million entries.<li><strong>Each FAT entry contains a number</strong> that points to the next cluster in the file. This forms a linked list.</ol><p>For example, suppose you have a file called <code>song.mp3</code> that occupies three clusters: 100, 215, and 316. The directory entry for <code>song.mp3</code> stores the starting cluster number (100) along with the filename and file size. When you read the file:<ul><li>Look at FAT entry 100, which contains the value 215 (the next cluster is 215)<li>Look at FAT entry 215, which contains the value 316 (the next cluster is 316)<br><li>Look at FAT entry 316, which contains a special end-of-file marker (0xFFFFFFFF)</ul><p>This linked-list-traversal style means reading a file requires multiple lookups in the FAT table, especially if the file is stored in non-contiguous clusters. In ext2, the inode directly stores pointers to the first 12 data blocks and we can directly read them without traversing a chain.<p>The biggest advantage of FAT32 is universal compatibility. Almost every OS can read and write it without special drivers. This is why FAT32 remains standard today for UEFI boot partitions in your PC and SD cards in cameras.<p>However, FAT32 has many limitations:<div class="quarto-figure quarto-figure-center" style=max-width:360px;float:right;margin-left:30px><figure class=figure><p><img src=../images/fat32-limit.png class="img-fluid figure-img"><figcaption>FAT32 file size limits</figcaption></figure></div><ul><li><strong>4GB file size limit</strong>: Because FAT32 uses 32 bits to store file size in the directory entry, no single file can exceed 2^32 bytes = 4GB. This makes FAT32 unusable for recording 4K video today, but it worked fine for MP3 files that typically ranged from 3MB to 10MB.<li><strong>Slower file lookups</strong>: Finding all the blocks of a file requires multiple disk <em>seeks</em>. On a mechanical drive with slow seek times, this is noticeably slower than the direct/indirect block pointer approach in ext2 or the B-tree indexing in HFS+.<li><strong>No journaling</strong>: If power fails during a write operation, the file system can become corrupted with no easy recovery mechanism (but this is probably fine for iPod because its file-system is only written when user download the songs, which is infrequent compared to reading mp3 files during daily use).</ul></section><section id=why-bother-with-hfs class=level3><h3 class=anchored data-anchor-id=why-bother-with-hfs>Why Bother with HFS+?</h3><p>Apple formatted every iPod as FAT32 at the factory. But this is not the end of the story. <strong>When a user connected an iPod to a Mac for the first time, iTunes would silently reformat it to HFS+.</strong> Windows users never saw this happen. Their iPods stayed as FAT32 forever. But hey, if FAT32 is fine for iPod, why did Apple reformat iPods to HFS+ when connected to Macs? The answer is probably to save battery life.<p>The iPod had a slow ARM processor and only 32MB of RAM. Spinning the mechanical hard drive was power-hungry and made the iPod vulnerable to shock damage. Every second the drive spent spinning was a second it could be dropped and have data corrupted.<p>To maximize battery life and minimize mechanical risk, the iPod used an ‚Äúsuck-up‚Äù buffering strategy: spin up the disk once, load about 30MB of upcoming songs into RAM as quickly as possible, then immediately stop the disk. The remaining 2MB of RAM was for the OS. The drive would only spin again when the buffer was nearly empty, which for most users meant 20 to 30 minutes of silent operation between spin-ups.<p>HFS+‚Äôs efficiency reduced the disk‚Äôs vulnerable timespan. On the other hand, on FAT32, if your song file is spread across 10 non-contiguous clusters, the system must read 10 different FAT entries and seek to 10 different disk locations. On a slow processor with a mechanical drive, this sucks up more battery life.<p>HFS+ uses <strong>B-trees</strong> to index files. A B-tree is a self-balancing tree structure where each node can have many children. This keeps the tree shallow. Instead of traversing a linked list, HFS+ can find any file‚Äôs blocks in logarithmic time. This typically means just 2 to 3 disk reads even for large directories. The iPod could load songs into memory faster and the drive could spin down sooner.<div class="quarto-figure quarto-figure-center" style=max-width:150px;float:right;margin-left:30px><figure class=figure><p><img src=../images/ipod_nano.svg class="img-fluid figure-img"><figcaption>iPod Nano</figcaption></figure></div><p>Apple released the <strong>iPod Nano</strong> in 2005 with flash memory instead of a mechanical drive. Flash memory has no moving parts. Your data remains ok even if you <strong>shake it</strong>. Nowadays, your phone could easily have 256GB flash memory at the size of a 1 NTD coin. But do you even store <strong>‚Äú1,000 songs in your pocket‚Äù</strong>??</section></section><section id=reiserfs class=level2><h2 class=anchored data-anchor-id=reiserfs>ReiserFS</h2><p>While Apple was optimizing for 5MB music files on fragile spinning disks, Linux servers were dealing with a different problem: millions of tiny files. Web servers, email servers, and code repositories store a lot of files smaller than 1KB.<p>As you learned in class, file systems allocate disk space in fixed blocks, usually 4KB. When you save a 100-byte configuration file, it still consumes an entire 4KB block. The remaining 3996 bytes cannot be used by other files. This waste is called <strong>internal fragmentation</strong>.<section id=tail-packing class=level3><h3 class=anchored data-anchor-id=tail-packing>Tail Packing</h3><p>In the early 2000s, kernel developer <strong>Hans Reiser</strong> created <strong>ReiserFS</strong> to solve this problem. Reiser studied computer science at UC Berkeley and had strong opinions about how file systems should work. ReiserFS, like HFS+, was built on B-trees. But Reiser added a feature called <strong>tail packing</strong>. Instead of giving small files their own blocks, ReiserFS stored the data directly inside B-tree leaf nodes alongside the metadata. If you had ten 100-byte files, ReiserFS could pack them all into a single 4KB disk block. This eliminated internal fragmentation for small files and increased a lot of usable storage space. By 2002, ReiserFS had become the SOTA file-system and was used by many companies.</section><section id=bus-factor-1 class=level3><h3 class=anchored data-anchor-id=bus-factor-1>Bus factor = 1</h3><div class="quarto-figure quarto-figure-center" style=max-width:360px><figure class=figure><p><img src=https://raw.githubusercontent.com/DXHeroes/knowledge-base-content/master/files/bus_factor.png class="img-fluid figure-img"><figcaption><a href=https://developerexperience.io/articles/bus-factor>source</a></figcaption></figure></div><p>In software engineering, the <strong>bus factor</strong> measures how many team members would need to disappear for a project to collapse. FAT32 has an infinite bus factor because the specification is public and thousands of engineers across dozens of companies have implemented it independently. ReiserFS had a bus factor of approximately <span class=red>one</span>, because Hans Reiser and his small company in Russia were the only code contributors to ReiserFS (while other file-systems in Linux kernel were combined efforts from more developers). Reiser was a genius but he frequently clashed with Linux kernel maintainers (who were equally smart).<p>Hans Reiser had a miserable marriage with his Russian wife, Nina Reiser. In 2006, he murdered his wife and was sent to prison. ReiserFS development stopped. ReiserFS was deprecated in 2022 and removed entirely from Linux in 2024. In prison, Hans learned social and communication skills. He apologized to the Linux community, and <a href=https://www.phoronix.com/news/ReiserFS-README-Linux-6.10>acknowledged his team members‚Äô contributions</a>.</section></section><section id=bring-home-lessons class="level2 page-columns page-full"><h2 class=anchored data-anchor-id=bring-home-lessons>Bring-home lessons</h2><ol type=1><li><p><strong>Data Structure matters</strong>: Both HFS+ and ReiserFS used B-trees to solve the problem of slow disk access. The iPod‚Äôs choice between FAT32‚Äôs linked lists and HFS+‚Äôs B-trees had measurable impact on battery life and how quickly the fragile mechanical drive could spin down.<li><p><strong>Compatibility matters</strong>: FAT32 has a 4GB file size limit, no journaling, and inefficient lookups. ReiserFS had better space efficiency and faster small-file access than the SOTA, ext3. Yet FAT32 is still here today while ReiserFS is gone. The iPod succeeded partly because it conformed to the commercial reality: clashing with Windows means killing yourself.</ol><div class="no-row-height column-margin column-container"><div class=margin-aside><p>But now, Apple intentionally makes itself Microsoft-incompatible to lock in people into the Apple ecosystem. think Air Drop. ü§®ü§®ü§®</div></div><ol start=3 type=1><li><strong>Maintainability matters</strong>: ReiserFS was technically impressive but depended on a single person. Apple chose FAT32 despite its limitations because it was stable and widely used. The Linux community eventually chose ext4 over ReiserFS, not because ext4 was more innovative, but because it had a sustainable development model.</ol></section><section id=want-to-learn-more class=level2><h2 class=anchored data-anchor-id=want-to-learn-more>Want to Learn More?</h2><p>This semester we spent only one week on file systems, but the world of data storage is far more fascinating than what we could cover. If you found today‚Äôs stories interesting, consider taking <strong>Advanced Storage Systems</strong> next semester taught by me.<p>We will explore the design and implementation of modern storage systems, and cutting-edge research that shape how operating systems manage data. You will learn by reading, analyzing, and discussing classic and contemporary research papers. We will cover core topics ranging from I/O devices and file system fundamentals to distributed storage and sandboxing techniques.<p>You will learn why Google built their own file system (GFS), how Copy-on-Write filesystems like Btrfs and ZFS work, and how modern cloud storage systems handle petabytes of data. <span class=green><strong>If you enjoyed thinking about data structures and tradeoffs in this lecture, you will find an entire semester of similar engineering challenges waiting for you.</strong></span><p><span class=big>Welcome to the wonderful world of system research.</span><hr><p>I wrote this handout after listening to the Co-Recursive podcast. Former Apple engineer David Shayer talked about Apple‚Äôs big secret in <a href=https://corecursive.com/063-apple-2001/>this episode</a> (Do you know iPod used to be a spy device for nuclear radiation detection??). The story of Hans Reiser is from <a href=https://corecursive.com/reiserfs/>this episode</a></section></section><a onclick="return window.scrollTo(0,0),!1" role=button id=quarto-back-to-top><i class="bi bi-arrow-up"></i> Back to top</a></main><script id=quarto-html-after-body>window.document.addEventListener("DOMContentLoaded",function(){const j="Óßã",c=new window.AnchorJS;c.options={placement:"right",icon:j},c.add(".anchored");const v=e=>{for(const t of e.classList)if(t.startsWith("code-annotation-"))return!0;return!1},p=function(e){const t=e.trigger;t.blur(),t.classList.add("code-copy-button-checked");var s=t.getAttribute("title");t.setAttribute("title","Copied!");let n;window.bootstrap&&(t.setAttribute("data-bs-toggle","tooltip"),t.setAttribute("data-bs-placement","left"),t.setAttribute("data-bs-title","Copied!"),n=new bootstrap.Tooltip(t,{trigger:"manual",customClass:"code-copy-button-tooltip",offset:[0,-8]}),n.show()),setTimeout(function(){n&&(n.hide(),t.removeAttribute("data-bs-title"),t.removeAttribute("data-bs-toggle"),t.removeAttribute("data-bs-placement")),t.setAttribute("title",s),t.classList.remove("code-copy-button-checked")},1e3),e.clearSelection()},m=function(e){const t=e.previousElementSibling.cloneNode(!0);for(const e of t.children)v(e)&&e.remove();return t.innerText},b=new window.ClipboardJS(".code-copy-button:not([data-in-quarto-modal])",{text:m});if(b.on("success",p),window.document.getElementById("quarto-embedded-source-code-modal")){const e=new window.ClipboardJS(".code-copy-button[data-in-quarto-modal]",{text:m,container:window.document.getElementById("quarto-embedded-source-code-modal")});e.on("success",p)}for(var s,g=new RegExp(/^(?:http|https):\/\/localhost:?[0-9]*\//),x=new RegExp(/^mailto:/),O=new RegExp("/"+window.location.host+"/"),w=e=>O.test(e)||g.test(e)||x.test(e),u=window.document.querySelectorAll("a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)"),t=0;t<u.length;t++){const e=u[t];w(e.href)||(e.dataset.originalHref!==0[0]&&(e.href=e.dataset.originalHref),e.setAttribute("target","_blank"),e.getAttribute("rel")===null&&e.setAttribute("rel","noopener"),e.classList.add("external"))}function i(e,t,n,s){const o={allowHTML:!0,maxWidth:500,delay:100,arrow:!1,appendTo:function(e){return e.parentElement},interactive:!0,interactiveBorder:10,theme:"quarto",placement:"bottom-start"};t&&(o.content=t),n&&(o.onTrigger=n),s&&(o.onUntrigger=s),window.tippy(e,o)}const f=window.document.querySelectorAll('a[role="doc-noteref"]');for(t=0;t<f.length;t++){const e=f[t];i(e,function(){let t=e.getAttribute("data-footnote-href")||e.getAttribute("href");try{t=new URL(t).hash}catch{}const s=t.replace(/^#\/?/,""),n=window.document.getElementById(s);return n?n.innerHTML:""})}const r=window.document.querySelectorAll("a.quarto-xref"),o=(e,t)=>{const n=e=>{if(e.classList.remove("page-full","page-columns"),e.children)for(const t of e.children)n(t)};if(n(t),e===null||e.startsWith("sec-")){const e=document.createElement("div");if(t.children&&t.children.length>2){e.appendChild(t.children[0].cloneNode(!0));for(let n=1;n<t.children.length;n++){const s=t.children[n];if(s.tagName==="P"&&s.innerText==="")continue;e.appendChild(s.cloneNode(!0));break}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(e),e.innerHTML}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(t),t.innerHTML}else{const e=t.querySelector("a.anchorjs-link");return e&&e.remove(),window.Quarto?.typesetMath&&window.Quarto.typesetMath(t),t.classList.contains("callout")?t.outerHTML:t.innerHTML}};for(t=0;t<r.length;t++){const e=r[t];i(e,0[0],function(t){t.disable();let n=e.getAttribute("href"),s=0[0];if(n.startsWith("#"))s=n;else try{s=new URL(n).hash}catch{}if(s){const e=s.replace(/^#\/?/,""),i=window.document.getElementById(e);if(i!==null)try{const n=o(e,i.cloneNode(!0));t.setContent(n)}finally{t.enable(),t.show()}else fetch(n.split("#")[0]).then(e=>e.text()).then(n=>{const i=new DOMParser,a=i.parseFromString(n,"text/html"),s=a.getElementById(e);if(s!==null){const n=o(e,s);t.setContent(n)}}).finally(()=>{t.enable(),t.show()})}else fetch(n).then(e=>e.text()).then(e=>{const s=new DOMParser,i=s.parseFromString(e,"text/html"),n=i.querySelector("main.content");if(n!==null){n.children.length>0&&n.children[0].tagName==="HEADER"&&n.children[0].remove();const e=o(null,n);t.setContent(e)}}).finally(()=>{t.enable(),t.show()})},function(){})}let n;const h=(e,t)=>{let n='data-code-cell="'+e+'"',s='data-code-annotation="'+t+'"';const o="span["+n+"]["+s+"]";return o},a=e=>{const d=window.document,i=e.getAttribute("data-target-cell"),r=e.getAttribute("data-target-annotation"),c=window.document.querySelector(h(i,r)),l=c.getAttribute("data-code-lines").split(","),t=l.map(e=>i+"-"+e);let s=null,o=null,a=null;if(t.length>0){const r=window.document.getElementById(t[0]);if(s=r.offsetTop,o=r.offsetHeight,a=r.parentElement.parentElement,t.length>1){const e=window.document.getElementById(t[t.length-1]),n=e.offsetTop+e.offsetHeight;o=n-s}if(s!==null&&o!==null&&a!==null){let e=window.document.getElementById("code-annotation-line-highlight");e===null&&(e=window.document.createElement("div"),e.setAttribute("id","code-annotation-line-highlight"),e.style.position="absolute",a.appendChild(e)),e.style.top=s-2+"px",e.style.height=o+4+"px",e.style.left=0;let t=window.document.getElementById("code-annotation-line-highlight-gutter");if(t===null){t=window.document.createElement("div"),t.setAttribute("id","code-annotation-line-highlight-gutter"),t.style.position="absolute";const e=window.document.getElementById(i),n=e.querySelector(".code-annotation-gutter");n.appendChild(t)}t.style.top=s-2+"px",t.style.height=o+4+"px"}n=e}},y=()=>{const e=["code-annotation-line-highlight","code-annotation-line-highlight-gutter"];e.forEach(e=>{const t=window.document.getElementById(e);t&&t.remove()}),n=0[0]};window.addEventListener("resize",_(()=>{elRect=0[0],n&&a(n)},10));function _(e,t){let s=!1,n;return(...o)=>{s?(n&&clearTimeout(n),n=setTimeout(()=>{e.apply(this,o),n=s=!1},t)):(e.apply(this,o),s=!0)}}const d=window.document.querySelectorAll(".code-annotation-anchor");for(let e=0;e<d.length;e++){const t=d[e],n=t.getAttribute("data-target-cell"),s=t.getAttribute("data-target-annotation"),o=()=>{const e=window.document.querySelector(h(n,s));if(e){const t=e.cloneNode(!0);return t.classList.add("code-annotation-tip-content"),t.outerHTML}},i={allowHTML:!0,content:o,onShow:e=>{a(e.reference),e.reference.classList.add("code-annotation-active"),window.tippy.hideAll()},onHide:e=>{y(),e.reference.classList.remove("code-annotation-active")},maxWidth:300,delay:[50,0],duration:[200,0],offset:[5,10],arrow:!0,appendTo:function(e){return e.parentElement.parentElement.parentElement},interactive:!0,interactiveBorder:10,theme:"quarto",placement:"right",popperOptions:{modifiers:[{name:"flip",options:{flipVariations:!1,allowedAutoPlacements:["right"],fallbackPlacements:["right","top","top-start","top-end","bottom","bottom-start","bottom-end","left"]}},{name:"preventOverflow",options:{mainAxis:!1,altAxis:!1}}]}};window.tippy(t,i)}const l=e=>{const t=e.parentElement;if(t){const n=t.dataset.cites;return n?{el:e,cites:n.split(" ")}:l(e.parentElement)}else return 0[0]};for(s=window.document.querySelectorAll('a[role="doc-biblioref"]'),t=0;t<s.length;t++){const n=s[t],e=l(n);e&&i(e.el,function(){var t=window.document.createElement("div");return e.cites.forEach(function(e){var s,n=window.document.createElement("div");n.classList.add("hanging-indent"),n.classList.add("csl-entry"),s=window.document.getElementById("ref-"+e),s&&(n.innerHTML=s.innerHTML),t.appendChild(n)}),t.innerHTML})}})</script></div><footer class=footer><div class=nav-footer><div class=nav-footer-left><p><img id=footer-cat-left src=../images/cat-left.png alt="Cat Left"></div><div class=nav-footer-center><p><span id=footer-center>Made with ‚ù§Ô∏è by Tony, (CC&nbsp;BY&nbsp;4.0)<br><span style=font-size:8px>Cat source: Freepik and ChatGPT</span></span></div><div class=nav-footer-right><p><img id=footer-cat-right src=../images/cat-right.png alt="Cat Right"></div></div></footer>