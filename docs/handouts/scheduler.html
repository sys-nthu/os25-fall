<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=en xml:lang=en><meta charset=utf-8><meta name=generator content="quarto-1.7.33"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes"><title>scheduler – Operating System (2025 Fall)</title><style>code{white-space:pre-wrap}span.smallcaps{font-variant:small-caps}div.columns{display:flex;gap:min(4vw,1.5em)}div.column{flex:auto;overflow-x:auto}div.hanging-indent{margin-left:1.5em;text-indent:-1.5em}ul.task-list{list-style:none}ul.task-list li input[type=checkbox]{width:.8em;margin:0 .8em .2em -1em;vertical-align:middle}html{-webkit-text-size-adjust:100%}pre>code.sourceCode{white-space:pre;position:relative}pre>code.sourceCode>span{display:inline-block;line-height:1.25}pre>code.sourceCode>span:empty{height:1.2em}.sourceCode{overflow:visible}code.sourceCode>span{color:inherit;text-decoration:inherit}div.sourceCode{margin:1em 0}pre.sourceCode{margin:0}@media screen{div.sourceCode{overflow:auto}}@media print{pre>code.sourceCode{white-space:pre-wrap}pre>code.sourceCode>span{text-indent:-5em;padding-left:5em}}pre.numberSource code{counter-reset:source-line 0}pre.numberSource code>span{position:relative;left:-4em;counter-increment:source-line}pre.numberSource code>span>a:first-child::before{content:counter(source-line);position:relative;left:-1em;text-align:right;vertical-align:baseline;border:none;display:inline-block;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;padding:0 4px;width:4em}pre.numberSource{margin-left:3em;padding-left:4px}div.sourceCode{}@media screen{pre>code.sourceCode>span>a:first-child::before{text-decoration:underline}}div.csl-bib-body{}div.csl-entry{clear:both;margin-bottom:0}.hanging-indent div.csl-entry{margin-left:2em;text-indent:-2em}div.csl-left-margin{min-width:2em;float:left}div.csl-right-inline{margin-left:2em;padding-left:1em}div.csl-indent{margin-left:2em}</style><script src=../site_libs/quarto-nav/quarto-nav.js></script><script src=../site_libs/clipboard/clipboard.min.js></script><script src=../site_libs/quarto-search/autocomplete.umd.js></script><script src=../site_libs/quarto-search/fuse.min.js></script><script src=../site_libs/quarto-search/quarto-search.js></script><meta name=quarto:offset content="../"><link href=../images/orange.png rel=icon type=image/png><script src=../site_libs/quarto-html/quarto.js type=module></script><script src=../site_libs/quarto-html/tabsets/tabsets.js type=module></script><script src=../site_libs/quarto-html/popper.min.js></script><script src=../site_libs/quarto-html/tippy.umd.min.js></script><script src=../site_libs/quarto-html/anchor.min.js></script><link href=../site_libs/quarto-html/tippy.css rel=stylesheet><link href=../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css rel=stylesheet id=quarto-text-highlighting-styles><script src=../site_libs/bootstrap/bootstrap.min.js></script><link href=../site_libs/bootstrap/bootstrap-icons.css rel=stylesheet><link href=../site_libs/bootstrap/bootstrap-a3d6f4078ec9f2632a80ad631344d584.min.css rel=stylesheet append-hash=true id=quarto-bootstrap data-mode=light><script id=quarto-search-options type=application/json>{"location":"navbar","copy-button":false,"collapse-after":3,"panel-placement":"end","type":"overlay","limit":50,"keyboard-shortcut":["f","/","s"],"show-item-context":false,"language":{"search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search"}}</script><body class="nav-sidebar docked nav-fixed slimcontent quarto-light"><div id=quarto-search-results></div><header id=quarto-header class="headroom fixed-top"><nav class="navbar navbar-expand-lg" data-bs-theme=dark><div class="navbar-container container-fluid"><div class="navbar-brand-container mx-auto"><a class=navbar-brand href=../index.html><span class=navbar-title>Operating System (2025 Fall)</span></a></div><div id=quarto-search title=Search></div><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarCollapse aria-controls=navbarCollapse role=menu aria-expanded=false aria-label="Toggle navigation" onclick=window.quartoToggleHeadroom&&window.quartoToggleHeadroom()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarCollapse><ul class="navbar-nav navbar-nav-scroll me-auto"><li class=nav-item><a class="nav-link active" href=../index.html aria-current=page><span class=menu-text>Home</span></a><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=nav-menu-handouts role=link data-bs-toggle=dropdown aria-expanded=false><span class=menu-text>Handouts</span></a><ul class=dropdown-menu aria-labelledby=nav-menu-handouts><li><a class=dropdown-item href=../handouts/env_setup.html><span class=dropdown-text>Environment Setup</span></a><li><a class=dropdown-item href=../handouts/unix.html><span class=dropdown-text>Unix</span></a><li><a class=dropdown-item href=../handouts/privilege.html><span class=dropdown-text>Privilege</span></a><li><a class=dropdown-item href=../handouts/scheduler.html><span class=dropdown-text>Scheduler</span></a><li><a class=dropdown-item href=../handouts/buffercache.html><span class=dropdown-text>Buffer Cache</span></a></ul><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=nav-menu-labs role=link data-bs-toggle=dropdown aria-expanded=false><span class=menu-text>Labs</span></a><ul class=dropdown-menu aria-labelledby=nav-menu-labs><li><a class=dropdown-item href=../labs/mini-cloud.html><span class=dropdown-text>Mini Cloud</span></a><li><a class=dropdown-item href=../labs/linking.html><span class=dropdown-text>Linking</span></a><li><a class=dropdown-item href=../labs/process-creation.html><span class=dropdown-text>Process Creation</span></a><li><a class=dropdown-item href=../labs/process-state.html><span class=dropdown-text>Process State</span></a><li><a class=dropdown-item href=../labs/process-address-space.html><span class=dropdown-text>Process Address Space</span></a><li><hr class=dropdown-divider><li><a class=dropdown-item href=../labs/path-traversal.html><span class=dropdown-text>Path Traversal</span></a><li><a class=dropdown-item href=../labs/pipe-passwords.html><span class=dropdown-text>Pipe Passwords</span></a><li><a class=dropdown-item href=../labs/pipe-dup.html><span class=dropdown-text>Pipe and dup()</span></a><li><a class=dropdown-item href=../labs/pipe-pingpong.html><span class=dropdown-text>Pipe Ping-Pong</span></a><li><a class=dropdown-item href=../labs/fifo.html><span class=dropdown-text>FIFO (named pipe)</span></a><li><hr class=dropdown-divider><li><a class=dropdown-item href=../labs/cat.html><span class=dropdown-text>Cat</span></a><li><hr class=dropdown-divider><li><a class=dropdown-item href=../labs/xv6-syscall.html><span class=dropdown-text>xv6 System Call Tracing</span></a></ul><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=nav-menu-admin role=link data-bs-toggle=dropdown aria-expanded=false><span class=menu-text>Admin</span></a><ul class=dropdown-menu aria-labelledby=nav-menu-admin><li><a class=dropdown-item href=../admin/policies.html><span class=dropdown-text>Policies</span></a><li><a class=dropdown-item href=../admin/explore.html><span class=dropdown-text>Exploratory Projects</span></a><li><a class=dropdown-item href=../admin/waitbutwhy.html><span class=dropdown-text>SD1↓ (燒蛋一下)</span></a></ul></ul><ul class="navbar-nav navbar-nav-scroll ms-auto"><li class="nav-item compact"><a class=nav-link href="https://elearn.nthu.edu.tw/course/view.php?id=38873"><i class="bi bi-globe" role=img></i><span class=menu-text></span></a></ul></div><div class=quarto-navbar-tools></div></div></nav><nav class=quarto-secondary-nav><div class="container-fluid d-flex"><button type=button class="quarto-btn-toggle btn" data-bs-toggle=collapse role=button data-bs-target=.quarto-sidebar-collapse-item aria-controls=quarto-sidebar aria-expanded=false aria-label="Toggle sidebar navigation" onclick=window.quartoToggleHeadroom&&window.quartoToggleHeadroom()>
<i class="bi bi-layout-text-sidebar-reverse"></i></button><nav class=quarto-page-breadcrumbs aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=../weeks/w6.html>Worksheet 6</a><li class=breadcrumb-item><a href=../handouts/scheduler.html>Schedulers</a></ol></nav><a class=flex-grow-1 role=navigation data-bs-toggle=collapse data-bs-target=.quarto-sidebar-collapse-item aria-controls=quarto-sidebar aria-expanded=false aria-label="Toggle sidebar navigation" onclick=window.quartoToggleHeadroom&&window.quartoToggleHeadroom()></a><button type=button class="btn quarto-search-button" aria-label=Search onclick=window.quartoOpenSearch()>
<i class="bi bi-search"></i></button></div></nav></header><div id=quarto-content class="quarto-container page-columns page-rows-contents page-layout-article page-navbar"><nav id=quarto-sidebar class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center"><div class=sidebar-search><div id=quarto-search title=Search></div></div></div><div class=sidebar-menu-container><ul class="list-unstyled mt-1"><li class=sidebar-item><div class=sidebar-item-container><a href=../index.html class="sidebar-item-text sidebar-link"><span class=menu-text>OS 2025 Fall</span></a></div><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w2.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 2</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-1 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-1 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/env_setup.html class="sidebar-item-text sidebar-link"><span class=menu-text>Environment setup</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w3.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 3</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-2 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-2 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/unix.html class="sidebar-item-text sidebar-link"><span class=menu-text>Unix Philosophy</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/mini-cloud.html class="sidebar-item-text sidebar-link"><span class=menu-text>Your First Week in OS Journey</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/process-creation.html class="sidebar-item-text sidebar-link"><span class=menu-text><code>fork()</code>/<code>exec()</code></span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w4.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 4</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-3 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-3 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/privilege.html class="sidebar-item-text sidebar-link"><span class=menu-text>Privilege</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/path-traversal.html class="sidebar-item-text sidebar-link"><span class=menu-text>Lab: Path Traversal Attack</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/process-address-space.html class="sidebar-item-text sidebar-link"><span class=menu-text>Address Space Layout</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/linking.html class="sidebar-item-text sidebar-link"><span class=menu-text>Static vs Dynamic Linking</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w5.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 5</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-4 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-4 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/pipe-passwords.html class="sidebar-item-text sidebar-link"><span class=menu-text>Parallelizing Rainbow Table Lookup with Pipes</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/pipe-dup.html class="sidebar-item-text sidebar-link"><span class=menu-text>Pipes, Redirection, and File Descriptors</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/fifo.html class="sidebar-item-text sidebar-link"><span class=menu-text>FIFO (named pipe)</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w6.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 6</span></a>
<a class="sidebar-item-toggle text-start" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-5 role=navigation aria-expanded=true aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-5 class="collapse list-unstyled sidebar-section depth1 show"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/scheduler.html class="sidebar-item-text sidebar-link active"><span class=menu-text>Schedulers</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/process-state.html class="sidebar-item-text sidebar-link"><span class=menu-text>Process States in Linux</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/pipe-pingpong.html class="sidebar-item-text sidebar-link"><span class=menu-text>Pipe Pingpong</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w8.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 8</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-6 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-6 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../handouts/buffercache.html class="sidebar-item-text sidebar-link"><span class=menu-text>Caching and Buffering</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/cat.html class="sidebar-item-text sidebar-link"><span class=menu-text>How <code>cat</code> works?</span></a></div></ul><li class="sidebar-item sidebar-item-section"><div class=sidebar-item-container><a href=../weeks/w9.html class="sidebar-item-text sidebar-link"><span class=menu-text>Worksheet 9</span></a>
<a class="sidebar-item-toggle text-start collapsed" data-bs-toggle=collapse data-bs-target=#quarto-sidebar-section-7 role=navigation aria-expanded=false aria-label="Toggle section"><i class="bi bi-chevron-right ms-2"></i></a></div><ul id=quarto-sidebar-section-7 class="collapse list-unstyled sidebar-section depth1"><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/xv6-intro.html class="sidebar-item-text sidebar-link"><span class=menu-text>xv6 introduction</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/xv6-gdb.html class="sidebar-item-text sidebar-link"><span class=menu-text>GNU Debugger Tutorial</span></a></div><li class=sidebar-item><div class=sidebar-item-container><a href=../labs/xv6-syscall.html class="sidebar-item-text sidebar-link"><span class=menu-text>Syscall Tracing</span></a></div></ul></ul></div></nav><div id=quarto-sidebar-glass class=quarto-sidebar-collapse-item data-bs-toggle=collapse data-bs-target=.quarto-sidebar-collapse-item></div><div id=quarto-margin-sidebar class="sidebar margin-sidebar"><nav id=TOC role=doc-toc class=toc-active><h2 id=toc-title>On this page</h2><ul><li><a href=#schedulers id=toc-schedulers class="nav-link active" data-scroll-target=#schedulers>Schedulers</a><ul class=collapse><li><a href=#os-v.s-homework-scheduling id=toc-os-v.s-homework-scheduling class=nav-link data-scroll-target=#os-v.s-homework-scheduling>OS v.s Homework Scheduling</a><li><a href=#schedulers-goals id=toc-schedulers-goals class=nav-link data-scroll-target=#schedulers-goals>Scheduler’s Goals</a><li><a href=#preemptive-vs.-non-preemptive-scheduling id=toc-preemptive-vs.-non-preemptive-scheduling class=nav-link data-scroll-target=#preemptive-vs.-non-preemptive-scheduling>Preemptive vs.&nbsp;Non-Preemptive Scheduling</a><li><a href=#cpu-v.s-io-bursts id=toc-cpu-v.s-io-bursts class=nav-link data-scroll-target=#cpu-v.s-io-bursts>CPU v.s I/O Bursts</a><li><a href=#priority-scheduling id=toc-priority-scheduling class=nav-link data-scroll-target=#priority-scheduling>Priority Scheduling</a><ul class=collapse><li><a href=#nice id=toc-nice class=nav-link data-scroll-target=#nice><code>nice</code></a><li><a href=#the-completely-fair-scheduler-cfs id=toc-the-completely-fair-scheduler-cfs class=nav-link data-scroll-target=#the-completely-fair-scheduler-cfs>The Completely Fair Scheduler (CFS)</a></ul><li><a href=#multi-core-scheduling id=toc-multi-core-scheduling class=nav-link data-scroll-target=#multi-core-scheduling>Multi-Core Scheduling</a><ul class=collapse><li><a href=#cpu-affinity id=toc-cpu-affinity class=nav-link data-scroll-target=#cpu-affinity>CPU Affinity</a></ul><li><a href=#group-scheduling id=toc-group-scheduling class=nav-link data-scroll-target=#group-scheduling>Group Scheduling</a><li><a href=#load-balancing id=toc-load-balancing class=nav-link data-scroll-target=#load-balancing>Load Balancing</a><li><a href=#power id=toc-power class=nav-link data-scroll-target=#power>Power</a></ul></ul></nav></div><main class="content page-columns page-full" id=quarto-document-content><header id=title-block-header class=quarto-title-block><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=../weeks/w6.html>Worksheet 6</a><li class=breadcrumb-item><a href=../handouts/scheduler.html>Schedulers</a></ol></nav></header><section id=schedulers class="level1 page-columns page-full"><h1>Schedulers</h1><section id=cpu-time-sharing class=level4><h4 class=anchored data-anchor-id=cpu-time-sharing>CPU Time Sharing</h4><p>When we discussed interrupts in <a href=../weeks/w3.html>Worksheet 3</a>, we learned that they allow your computer to run multiple applications at the same time on a single CPU. When you have Excel, PowerPoint, and Chrome running at the same time on your laptop, the CPU is actually switching rapidly between these three programs.<p><img src=../images/time-sharing.png class=img-fluid><p>The question is: How long should each application be allowed to use the CPU before we interrupt it and switch to another? Each time an interrupt occurs to stop the currently running process, the kernel scheduler must make a decision about what to do next.</section><section id=os-v.s-homework-scheduling class="level2 page-columns page-full"><h2 class=anchored data-anchor-id=os-v.s-homework-scheduling>OS v.s Homework Scheduling</h2><div class="no-row-height column-margin column-container"><div class=margin-aside><p>This analogy is adopted from <a href="https://ocw.nycu.edu.tw/?course_page=all-course-2%2Fcollege-of-computer-science%2Foperating-system-design-and-implementation-osdi-104-academic-year-department-of-computer-science-prof-shiao-li-tsao%2Fprocess-management-part-ii">Prof.&nbsp;Shiao‐Li Tsao’s Process Management lecture</a></div></div><p>Let’s use an analogy to understand CPU scheduling. How do you manage your own homework schedule. You have multiple assignments to complete, each with different deadlines and importance levels. Professors continue assigning new work while you’re still working on existing assignments. In this scenario, you face several scheduling decisions.<ul><li><strong>What is the next homework assignment to work on?</strong> The scheduler also must decide which process should run next. Should you work on the assignment due tomorrow, or the more important project due next week? The scheduler must decide which process deserves CPU time based on various factors like priority, waiting time, and deadlines.<li><strong>When should you stop working on your current assignment?</strong> Perhaps you’ve been working on calculus for two hours and need a break, or maybe you realize you should switch to studying for tomorrow’s exam. The scheduler must decide when to <em>preempt</em> a running process (preempt means <span class=red><em>stop</em></span>). This could be because the process has used up its <a href=https://en.wikipedia.org/wiki/Preemption_(computing)#Time_slice>time slice</a>, a higher-priority process has become ready, or the current process is waiting for I/O.<li><strong>How long can you concentrate on one assignment before you fade out?</strong> This corresponds to the scheduling time quantum or time slice. Too short, and you spend more time switching between tasks than actually working. Too long, and other urgent tasks might be neglected.<li><strong>How much time do you spend deciding what to work on next?</strong> Every time you finish a task or decide to switch, you need a moment to make a choice. The scheduling algorithm also has an overhead: the time the CPU spends running the scheduler code itself to pick the next process to run.<li><strong>How much effort goes into switching from one assignment to another?</strong> You might need to close your calculus book, find your history notes, and mentally shift focus. This is similar to <span class=red>context switching overhead</span>: the CPU must save the current process state and load the state of the next process.<li><strong>What decides the importance of each assignment?</strong> Some homework might be worth 30% of your grade, other homeworks just &lt;1%. Processes have different priority levels. System processes might have higher priority than user applications.</ul></section><section id=schedulers-goals class=level2><h2 class=anchored data-anchor-id=schedulers-goals>Scheduler’s Goals</h2><ul><li><strong>Response Time</strong> is how quickly the system reacts to new event, like user’s keyboard input. When you edit in VS Code, you press <code>t</code> on the keyboard and 2 seconds later <code>t</code> appears on the screen. This is laggy!! This means the system has a bad response time.<li><strong>Throughput</strong> is the total amount of work the CPU completes over a period. You want to compile your code in three seconds, not in five seconds.</ul><p>These two goals can conflict. To ensure a fast response time, the scheduler may need to interrupt a long-running task to quickly handle user input. This interruption improves the user’s perception of performance, but the context switch adds overhead and slows down the original task, which can decrease overall throughput.<p>There are other goals:<blockquote class=blockquote><p>In real-time environments, such as embedded systems for automatic control in industry (for example robotics), the scheduler also must ensure that processes can meet deadlines; this is crucial for keeping the system stable. (Source: <a href=https://en.wikipedia.org/wiki/Scheduling_(computing)>Wikipedia</a>)</blockquote></section><section id=preemptive-vs.-non-preemptive-scheduling class=level2><h2 class=anchored data-anchor-id=preemptive-vs.-non-preemptive-scheduling>Preemptive vs.&nbsp;Non-Preemptive Scheduling</h2><p>Modern operating systems use <strong>preemptive</strong> scheduling for time-sharing the CPU. In preemptive scheduling, the operating system can interrupt a running process and switch to another process, even if the current process hasn’t finished its work. This ensures that no single process can occupy the CPU all the time. When you’re typing in a word processor while a video is playing in the background and a file is downloading, preemptive scheduling ensures that each of these activities gets regular access to the CPU.<p><strong>Non-preemptive</strong> (or <span class=green><strong>cooperative</strong></span>) scheduling requires processes to voluntarily give up the CPU when they’re finished or when they need to wait for I/O. The process itself decides when to yield control back to the operating system. If the process <a href=https://tinyurl.com/nhk5npwt>站著毛坑不拉屎</a>, the whole system will hang there .<p>To understand why both preemptive and non-preemptive scheduling exist, we need to look at the historical context of computing and how different types of computer systems evolved to serve different needs.<section id=cooperative-scheduling-in-the-early-days class=level4><h4 class=anchored data-anchor-id=cooperative-scheduling-in-the-early-days>Cooperative scheduling in the early days</h4><p>Early PC like the Apple Mac System 6/7 (1988-1991) and Microsoft’s DOS had very limited RAM (&lt; 1MB) and slow processors like the Motorola 68000. At that time, users typically ran one main application at a time, like Microsoft Word or Photoshop. If Word is misbehaving, the whole system will enter blue screen, and only reboot can fix it.<div class="quarto-figure quarto-figure-center" style=margin:10px;max-width:180px;float:right><figure class=figure><p><img src=../images/screen-editor.png class="img-fluid figure-img"><figcaption>Screen editor software (loaded from a tape) (photo taken by me at The Museum of the 20th Century in Hoorn, Netherland)</figcaption></figure></div><p>These systems used <strong>cooperative scheduling</strong> because cooperative scheduling avoided the overhead of frequent timer interrupts and context switches, which were more noticeable on slower hardware. The main application received all CPU time, while background applications made no progress until the active program voluntarily yielded control. If Photoshop was drawing a complex image, your email application wouldn’t fetch new messages until Photoshop finished and yielded the CPU.<p>Here are some photos I took during a trip to <a href=https://maps.app.goo.gl/KWbqaxWKsA8Fxks17>a musuem in Netherland</a>: applications are loaded from tape or cartridge like these and user just run this application the entire time without switching to others (there is no others).<div class="quarto-figure quarto-figure-center" style=margin:10px;max-width:380px;float:right><figure class=figure><p><img src=../images/word-card.png class="img-fluid figure-img"><figcaption>Word processor cartridge for Mac (photo taken by me at The Museum of the 20th Century in Hoorn, Netherland)</figcaption></figure></div><div class="quarto-figure quarto-figure-center" style=margin:10px;max-width:380px;float:right><figure class=figure><p><img src=../images/commondore.png class="img-fluid figure-img"><figcaption>Game (loaded from a tape) (photo taken by me at The Museum of the 20th Century in Hoorn, Netherland)</figcaption></figure></div></section><section id=preemptive-scheduling-prevents-misbehaving-processes class=level4><h4 class=anchored data-anchor-id=preemptive-scheduling-prevents-misbehaving-processes>Preemptive scheduling prevents misbehaving processes</h4><p>When you bought a Mac or PC, you were typically the only user, so if Word crashed, you simply rebooted. No big deal. But this is not ok if the computer must be shared with other people. In early Unix workstations, multiple users could log into the same machine. The kernel had no control over what kind of programs users might run, and it couldn’t trust all programs to be well-behaved and cooperatively yield the CPU. In this environment, one user’s infinite loop or poorly written program could completely lock out other users from the system. Unix systems must use <strong>preemptive scheduling</strong> to ensure users share CPU fairly.<p>This continue to hold true until today. In data center server, there can be <span class=red><strong>millions</strong></span> of processes running at the same time on one single machine that might have more than 100 CPU cores. If one user is doing crypto mining, he should not be able to bring down the entire machine.</p></section></section><section id=cpu-v.s-io-bursts class=level2><h2 class=anchored data-anchor-id=cpu-v.s-io-bursts>CPU v.s I/O Bursts</h2><p>A scheduler cannot treat all processes equally because not all processes behave the same way. The execution of a typical process is a cycle of two phases: a CPU burst, where it performs computations, and an I/O burst, where it waits for an I/O operation to complete (e.g., reading from a disk, or waiting for a user to press a key). There are two types of programs<ul><li><p><strong>I/O-Bound Programs</strong>: have many short CPU bursts and long periods of waiting for I/O. A text editor like VS Code is a great example. It spends most of its time waiting for the user to type the next key. Most interactive, GUI applications fall into this category.<li><p><strong>CPU-Bound Programs</strong>: have very long CPU bursts and are doing purely calculations. Examples include video rendering or compiling codes.</ul><p>Do you have this experience? You play a shooting game (which is CPU-bound) and try to type a message, but the character you type take a long time to appear on screen? Each key you press generates an interrupt and creates a tiny, high-priority task: display this character. This task is extremely short and unlikely to use its entire time slice. If the scheduler doesn’t immediately pause the game to run this task, the keypress has to wait. And you will <span class=red>feel the lag</span>.<p>To prevent this, scheduler increases the priority of interactive programs. When you press a key in VS Code, the OS wakes up the VS Code process, gives it a high priority, and the scheduler immediately preempts other lower-priority CPU-bound programs. The process runs its very short CPU burst to handle the input and then quickly goes back to waiting and release the CPU. Then, your computer feels responsive, even when a CPU-bound process is running in the background.</section><section id=priority-scheduling class=level2><h2 class=anchored data-anchor-id=priority-scheduling>Priority Scheduling</h2><p>The scheduler assigns a <strong>priority</strong> to each process. When it’s time to pick the next process to run, the scheduler chooses the one with the highest priority from the pool of ready processes. But a situation can happen: high-priority processes run all the time while low-priority processes might never get a chance to run. This is called <strong>starvation</strong>.<p>To prevent this, operating systems use <strong>dynamic priorities</strong>. Instead of a fixed priority, a process’s priority can change over its lifetime. For example, a process that has been waiting for a long time might have its priority gradually increased by the OS. This is called <strong>aging</strong>. This makes sure that eventually every process’s priority will become high enough to be scheduled. On the other hand, the priority of a process that has used all its time slice can be lowered to give other processes a chance.<p>Here are additional goals for priority scheduling:<ul><li><strong>Fairness</strong> ensures every process gets proportional CPU time according to its priority<li><strong>Liveness</strong> ensures even the lowest-priority process gets a chance to run eventually gets a turn to run on the CPU within a finite amount of time. In other words, liveness means <span class=green>free from starvation</span></ul><section id=nice class=level3><h3 class=anchored data-anchor-id=nice><code>nice</code></h3><p><img src=https://i1.sndcdn.com/artworks-000104260670-3dig52-t1080x1080.jpg class=img-fluid style=max-width:180px;float:right><p>In Linux, every process has a <strong><code>nice</code> value</strong> that define its priority. It’s called “nice” because a process with a higher nice value is “nicer” to other processes on the system. It voluntarily runs at a <em>lower</em> priority.<p>The <code>nice</code> range is from <strong>-20</strong> to <strong>+19</strong>:<ul><li><strong>-20</strong>: The highest priority (least “nice”).<li><strong>+19</strong>: The lowest priority (most “nice”).<li><strong>0</strong>: The default value inherited from the parent process.</ul><p>If you want to compile a large software project or render a 4K video (both are very CPU-bound), you can start this process with a high nice value to ensure it doesn’t make your desktop laggy, like this:<p><code>$ nice -n 15 ./my-video-encoder</code></section><section id=the-completely-fair-scheduler-cfs class=level3><h3 class=anchored data-anchor-id=the-completely-fair-scheduler-cfs>The Completely Fair Scheduler (CFS)</h3><p>CFS has been the standard scheduler in the Linux kernel for a long time. Its goal is to achieve perfect fairness. If a single process is running, it would receive 100% of CPU time. If two processes are running, each would get 50% of CPU time. If 4 processes are running, each would get 25%, and so on.<p>CFS doesn’t use fixed time slices like <a href=https://en.wikipedia.org/wiki/Round-robin_scheduling>Round-Robin Scheduling</a>. CFS uses <strong><code>vruntime</code></strong> (virtual runtime) to track how long a process has been allowed to run on the CPU. CFS always picks the process with the lowest <code>vruntime</code> to run next.<section id=vruntime-is-weighted-by-nice class=level4><h4 class=anchored data-anchor-id=vruntime-is-weighted-by-nice><code>vruntime</code> is weighted by <code>nice</code></h4><p>The <strong><code>nice</code> value</strong> of a process decides how quickly that process’s <code>vruntime</code> increases. A high-priority process (with a low or negative <code>nice</code> value)’s <code>vruntime</code> increases <em>more slowly</em> than a normal process. Since its <code>vruntime</code> stays lower for longer, the scheduler will choose it more often. On the other hand, a low-priority process (with a high positive <code>nice</code> value)’s <code>vruntime</code> increases <em>more quickly</em>. Thus, it is scheduled less frequently. CFS’s mechanism gives more CPU time to more important tasks but still make sure low-priority task is not starved.<div class="callout callout-style-default callout-note callout-titled"><div class="callout-header d-flex align-content-center" data-bs-toggle=collapse data-bs-target=.callout-1-contents aria-controls=callout-1 aria-expanded=true aria-label="Toggle callout"><div class=callout-icon-container><i class=callout-icon></i></div><div class="callout-title-container flex-fill">Run Queue</div><div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class=callout-toggle></i></div></div><div id=callout-1 class="callout-1-contents callout-collapse collapse show"><div class="callout-body-container callout-body"><p>A runqueue is the list of processes that are in the <span class=green>ready state</span>. They are not waiting for I/O or sleeping. They are fully prepared to run and are just waiting for a CPU core to be released.</div></div></div></section><section id=how-cfs-make-scheduling-decision-fast class=level4><h4 class=anchored data-anchor-id=how-cfs-make-scheduling-decision-fast>How CFS make scheduling decision fast?</h4><p>CFS can pick the process with the lowest <code>vruntime</code> to run <strong>fast</strong> because it maintains its run queue with a red-black tree sorted by the <code>vruntime</code>. The process with the minimum <code>vruntime</code> is always the leftmost node.<p>When timer interrupt occurs, CFS looks at the current process’s <code>vruntime</code>. If it exceeds a predefined budget, the process will be preempted if there are other runnable processes available. The process will also be preempted if the there is another process ready to run who has a smaller <code>vruntime</code>.</section></section></section><section id=multi-core-scheduling class=level2><h2 class=anchored data-anchor-id=multi-core-scheduling>Multi-Core Scheduling</h2><p><img src=../images/multi-core-sched.png class=img-fluid style=margin:10px;max-width:250px;float:right><p>On a multi-core system, the scheduler doesn’t just pick the next task, it must also decide which CPU core to run it. Consider a 2-core system. <span class=red>Process A</span> is running on <strong>Core 0</strong> and has filled its super-fast L1 and L2 caches with its data and instructions. Suddenly, a timer interrupt preempts it. The CFS scheduler runs and finds <span class=green>process B</span> now has the lowest <code>vruntime</code>, so the kernel context switches to <span class=green>Process B</span> to run on <strong>Core 0</strong>. <span class=red>Process A</span> is now waiting in the runqueue, but no one is currently running on <strong>Core 1</strong>. Should the scheduler resume process A on CPU Core 1? This is known as <em>task migration</em>. Migrating to Core 1 would incur a significant performance penalty from <span class=red>cache misses</span>, because all of <span class=red>process A</span>’s data would need to be reloaded from slow main memory. Therefore, the scheduler will often prefer to let <span class=red>process A</span> wait a little longer to resume on Core 0, where its data is still “hot” in the cache, because the performance benefit from more cache hits could be greater than the performance benefit of starting a few microseconds earlier on a different core.<section id=cpu-affinity class=level3><h3 class=anchored data-anchor-id=cpu-affinity>CPU Affinity</h3><p>The scheduler’s preference to keep a process on a core with a hot cache is known as <strong>soft affinity</strong>. It’s a “best effort” attempt, but the scheduler can override it if necessary to balance the system’s overall load.<p>We can force the scheduler to always run a process in a specific CPU core. This is called <em>process pinning</em>. In Linux, you can use the <code>taskset</code> command:<div class=sourceCode id=cb1><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id=cb1-1><a href=#cb1-1 aria-hidden=true tabindex=-1></a><span class=ex>$</span> taskset <span class=at>-c</span> 0 ./my-process</span></code><button title="Copy to Clipboard" class=code-copy-button><i class=bi></i></button></pre></div><p>This ensures that <code>my-process</code> will always run on CPU core 0. This can improves that process’s performance because it might have better CPU cache hit rate, but there might be some CPU left idle.</section></section><section id=group-scheduling class=level2><h2 class=anchored data-anchor-id=group-scheduling>Group Scheduling</h2><p>Suppose you have 25 processes running, CFS will try to give each one an equal 4% share of the CPU. However, imagine that 20 of those processes belong to user A, 5 of them belong to user B. Then, it means that user A receives 80% of the total CPU power, but user B only gets 20%.<p>Group scheduling prevents this unfairness. It tries to be fair between groups: User A and User B’s process group each get 50% of CPU time. Then, group scheduling ensures fairness within each group. User A’s 50% share is divided equally among their 20 processes. User B’s 50% share is divided among the 5 processes.</section><section id=load-balancing class=level2><h2 class=anchored data-anchor-id=load-balancing>Load Balancing</h2><p>Suppose you have 4 CPU cores and 4 processes to run, you want each core to run one process so all of them can finish earlier. You don’t want one core to run 4 processes while the other three cores are idle. This is called <em>Load Balancing</em>.<p>This might sound simple. But running the load-balancing procedure can be very expensive. The scheduler might need to check multiple runqueues of many other cores and modify data that may be in another core’s cache.<p>The paper you are about to read explains that this difficulty.<section id=the-linux-scheduler-a-decade-of-wasted-cores class=level4><h4 class=anchored data-anchor-id=the-linux-scheduler-a-decade-of-wasted-cores>The Linux Scheduler: a Decade of Wasted Cores</h4><p>Try to understand Section 2.2 of the classic paper, “The Linux Scheduler: a Decade of Wasted Cores.” <span class=citation data-cites=sched:16>(<a href=#ref-sched:16 role=doc-biblioref>Lozi et al. 2016</a>)</span> <a href=https://people.ece.ubc.ca/sasha/papers/eurosys16-final29.pdf>PDF of the paper</a> Don’t worry if you don’t fully understand it.<blockquote class=blockquote><p>The motivation for per-core runqueues is that upon a context switch the core would access only its local runqueue, when it looks for a thread to run. Context switches are on a critical path, so they must be fast. Accessing only a core-local queue prevents the scheduler from making potentially expensive synchronized accesses, which would be required if it accessed a globally shared runqueue.</blockquote><p>Multiple kernel processes modifying the same run queue at the same time will cause problems. The kernel needs to maintain lock to prevent this, and this can reduce performance. That’s why Linux maintains a separate red-black tree run queue for each CPU core. But the problem is: some cores will become idle, some cores will be busy all the time. This is the load-balancing problem the paper is talking about. The scheduler is supposed to be <a href=https://en.wikipedia.org/wiki/Work-conserving_scheduler>work-conserving</a> (meaning that the CPU is kept always busy, no idle time is wasted), but in practice CFS could not ensure this. The scheduler also doesn’t always steal ready process from other occupied core to run on a currently idle core. This is called <span class=green><em>work stealing</em></span>.<blockquote class=blockquote><p>A strawman load-balancing algorithm would simply ensure that each runqueue has roughly the same number of threads. However, this is not necessarily what we want.</blockquote><p>Why?<p><a href=#multi-core-scheduling>As we mention earlier</a>, process migration might not be good because the performance benefit from more cache hits could be greater than the performance benefit of starting a few microseconds earlier on a different core.<hr><p>The paper also points out the <em>Tickless Idle</em> mechanism and why it might affect response time.<p>In the old days, every CPU core got a regular “tick”. Timer interrupt arrives at a fixed frequency (say every millisecond). These ticks let the scheduler update time, decide if tasks should be switched, and check if load balancing is needed. But if a CPU core has no work, these ticks are wasteful. Waking up just to confirm “I’m still idle” costs energy. This is terrible for laptop and smartphone.<p>So Linux introduced <span class=green>Tickless Idle</span>. When a CPU core has nothing to do, the kernel can stop its periodic ticks and let it fall into a deep sleep state. This saves power. For example, if your phone is sitting in your pocket, you don’t want idle cores waking up a thousand times per second just to discover nothing has changed.<p>But here’s the trade-off: a sleeping core does not check the system by itself anymore. If another core is overloaded, the idle core will not come to help unless it is explicitly woken up. That means another CPU has to send it a signal to say ’hey, wake up, I’ve got work for you.” This can create problems: one CPU might be busy drowning, while its neighbor stays 躺平 .</p></section></section><section id=power class="level2 page-columns page-full"><h2 class=anchored data-anchor-id=power>Power</h2><p>Another goal of OS scheduler is to save power. This is very important for laptop and smartphone to have longer battery life.<p>CPUs from <a href=https://en.wikipedia.org/wiki/Alder_Lake>Intel</a>, AMD, Apple, and ARM, all have different core types on a single CPU. They have high-performance cores, called <strong>“big” or P-cores</strong>, and power-efficient cores, known as <strong>“small” or E-cores</strong>.<ul><li>P-core is fast but power-hungry.<li>E-cores is slower but energy-efficient.</ul><div class="no-row-height column-margin column-container"><div class=margin-aside><p>補充資料: <a href=https://eclecticlight.co/2023/10/23/how-does-macos-manage-virtual-cores-on-apple-silicon/>This article</a> has a very interesting discussion on Apple Sillicon’s Scheduling</div></div><p>Now the decision the scheduler should make is even more complex. It should now decide <em>where</em> to put a process to save power but without sacrificing performance too much. Generally speaking, running a background process in E-core can save energy. It doesn’t matter whether it finishes in 2 or 10 seconds. But it is also possible that running it on P-core for 2 seconds consumes less total energy compared to taking 10 seconds on an E-core.<div class="quarto-figure quarto-figure-center"><figure class=figure><p><img src=https://eclecticlight.co/wp-content/uploads/2022/04/coremanm1pro.png class="img-fluid figure-img"><figcaption>How macOS manages M1 CPU cores (<a href=https://eclecticlight.co/2022/04/25/how-macos-manages-m1-cpu-cores/>Source</a>)</figcaption></figure></div><p>For example, your Anti-virus software scans files in background, running it on an E-core saves energy. Whether it finishes in 2 or 10 seconds doesn’t matter to the user. But sometimes, running the same task briefly on a P-core and letting it go back to sleep can actually use less total energy. A faster finish means the system can return to a deep idle state sooner.<blockquote class=blockquote><p>“It is sometimes more efficient to get a job done quickly and go idle than it is to drag it out at a lower CPU frequency.” (<a href=https://lwn.net/Articles/481055/>LWN: Power-aware scheduling</a>)</blockquote><p>Energy efficiency is not always about stretching tasks out slowly at low power. Sometimes running fast is better.<blockquote class=blockquote><p>“Schedulers must balance system throughput with energy efficiency; placing the right task on the right CPU is crucial for overall performance and power consumption.” (<a href=https://lwn.net/Articles/909611/>LWN: Energy-aware scheduling in Linux</a>)</blockquote><p>On systems with asymmetric cores, the scheduler has to know which tasks truly <em>need</em> a P-core’s performance, and which can live comfortably on an E-core. For example, a video encoding thread might demand high performance, while a background file sync can run on an E-core.<p>The key point is: <strong>power-aware scheduling is workload dependent</strong>. The “right” decision depends on how urgent the task is, how much energy each option consumes, and whether finishing sooner allows deeper idle states.</section></section><a onclick="return window.scrollTo(0,0),!1" role=button id=quarto-back-to-top><i class="bi bi-arrow-up"></i> Back to top</a><div id=quarto-appendix class=default><section class=quarto-appendix-contents role=doc-bibliography id=quarto-bibliography><h2 class="anchored quarto-appendix-heading">References</h2><div id=refs class="references csl-bib-body hanging-indent" data-entry-spacing=0 role=list><div id=ref-sched:16 class=csl-entry role=listitem>Lozi, Jean-Pierre, Baptiste Lepers, Justin Funston, Fabien Gaud, Vivien Quéma, and Alexandra Fedorova. 2016. <span>“The Linux Scheduler: A Decade of Wasted Cores.”</span> In <em>Proceedings of the Eleventh European Conference on Computer Systems</em>. EuroSys ’16. New York, NY, USA: Association for Computing Machinery. <a href=https://doi.org/10.1145/2901318.2901326>https://doi.org/10.1145/2901318.2901326</a>.</div></div></section></div></main><script id=quarto-html-after-body>window.document.addEventListener("DOMContentLoaded",function(){const j="",c=new window.AnchorJS;c.options={placement:"right",icon:j},c.add(".anchored");const v=e=>{for(const t of e.classList)if(t.startsWith("code-annotation-"))return!0;return!1},p=function(e){const t=e.trigger;t.blur(),t.classList.add("code-copy-button-checked");var s=t.getAttribute("title");t.setAttribute("title","Copied!");let n;window.bootstrap&&(t.setAttribute("data-bs-toggle","tooltip"),t.setAttribute("data-bs-placement","left"),t.setAttribute("data-bs-title","Copied!"),n=new bootstrap.Tooltip(t,{trigger:"manual",customClass:"code-copy-button-tooltip",offset:[0,-8]}),n.show()),setTimeout(function(){n&&(n.hide(),t.removeAttribute("data-bs-title"),t.removeAttribute("data-bs-toggle"),t.removeAttribute("data-bs-placement")),t.setAttribute("title",s),t.classList.remove("code-copy-button-checked")},1e3),e.clearSelection()},m=function(e){const t=e.previousElementSibling.cloneNode(!0);for(const e of t.children)v(e)&&e.remove();return t.innerText},b=new window.ClipboardJS(".code-copy-button:not([data-in-quarto-modal])",{text:m});if(b.on("success",p),window.document.getElementById("quarto-embedded-source-code-modal")){const e=new window.ClipboardJS(".code-copy-button[data-in-quarto-modal]",{text:m,container:window.document.getElementById("quarto-embedded-source-code-modal")});e.on("success",p)}for(var s,g=new RegExp(/^(?:http|https):\/\/localhost:?[0-9]*\//),x=new RegExp(/^mailto:/),O=new RegExp("/"+window.location.host+"/"),w=e=>O.test(e)||g.test(e)||x.test(e),u=window.document.querySelectorAll("a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)"),t=0;t<u.length;t++){const e=u[t];w(e.href)||(e.dataset.originalHref!==0[0]&&(e.href=e.dataset.originalHref),e.setAttribute("target","_blank"),e.getAttribute("rel")===null&&e.setAttribute("rel","noopener"),e.classList.add("external"))}function i(e,t,n,s){const o={allowHTML:!0,maxWidth:500,delay:100,arrow:!1,appendTo:function(e){return e.parentElement},interactive:!0,interactiveBorder:10,theme:"quarto",placement:"bottom-start"};t&&(o.content=t),n&&(o.onTrigger=n),s&&(o.onUntrigger=s),window.tippy(e,o)}const f=window.document.querySelectorAll('a[role="doc-noteref"]');for(t=0;t<f.length;t++){const e=f[t];i(e,function(){let t=e.getAttribute("data-footnote-href")||e.getAttribute("href");try{t=new URL(t).hash}catch{}const s=t.replace(/^#\/?/,""),n=window.document.getElementById(s);return n?n.innerHTML:""})}const r=window.document.querySelectorAll("a.quarto-xref"),o=(e,t)=>{const n=e=>{if(e.classList.remove("page-full","page-columns"),e.children)for(const t of e.children)n(t)};if(n(t),e===null||e.startsWith("sec-")){const e=document.createElement("div");if(t.children&&t.children.length>2){e.appendChild(t.children[0].cloneNode(!0));for(let n=1;n<t.children.length;n++){const s=t.children[n];if(s.tagName==="P"&&s.innerText==="")continue;e.appendChild(s.cloneNode(!0));break}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(e),e.innerHTML}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(t),t.innerHTML}else{const e=t.querySelector("a.anchorjs-link");return e&&e.remove(),window.Quarto?.typesetMath&&window.Quarto.typesetMath(t),t.classList.contains("callout")?t.outerHTML:t.innerHTML}};for(t=0;t<r.length;t++){const e=r[t];i(e,0[0],function(t){t.disable();let n=e.getAttribute("href"),s=0[0];if(n.startsWith("#"))s=n;else try{s=new URL(n).hash}catch{}if(s){const e=s.replace(/^#\/?/,""),i=window.document.getElementById(e);if(i!==null)try{const n=o(e,i.cloneNode(!0));t.setContent(n)}finally{t.enable(),t.show()}else fetch(n.split("#")[0]).then(e=>e.text()).then(n=>{const i=new DOMParser,a=i.parseFromString(n,"text/html"),s=a.getElementById(e);if(s!==null){const n=o(e,s);t.setContent(n)}}).finally(()=>{t.enable(),t.show()})}else fetch(n).then(e=>e.text()).then(e=>{const s=new DOMParser,i=s.parseFromString(e,"text/html"),n=i.querySelector("main.content");if(n!==null){n.children.length>0&&n.children[0].tagName==="HEADER"&&n.children[0].remove();const e=o(null,n);t.setContent(e)}}).finally(()=>{t.enable(),t.show()})},function(){})}let n;const h=(e,t)=>{let n='data-code-cell="'+e+'"',s='data-code-annotation="'+t+'"';const o="span["+n+"]["+s+"]";return o},a=e=>{const d=window.document,i=e.getAttribute("data-target-cell"),r=e.getAttribute("data-target-annotation"),c=window.document.querySelector(h(i,r)),l=c.getAttribute("data-code-lines").split(","),t=l.map(e=>i+"-"+e);let s=null,o=null,a=null;if(t.length>0){const r=window.document.getElementById(t[0]);if(s=r.offsetTop,o=r.offsetHeight,a=r.parentElement.parentElement,t.length>1){const e=window.document.getElementById(t[t.length-1]),n=e.offsetTop+e.offsetHeight;o=n-s}if(s!==null&&o!==null&&a!==null){let e=window.document.getElementById("code-annotation-line-highlight");e===null&&(e=window.document.createElement("div"),e.setAttribute("id","code-annotation-line-highlight"),e.style.position="absolute",a.appendChild(e)),e.style.top=s-2+"px",e.style.height=o+4+"px",e.style.left=0;let t=window.document.getElementById("code-annotation-line-highlight-gutter");if(t===null){t=window.document.createElement("div"),t.setAttribute("id","code-annotation-line-highlight-gutter"),t.style.position="absolute";const e=window.document.getElementById(i),n=e.querySelector(".code-annotation-gutter");n.appendChild(t)}t.style.top=s-2+"px",t.style.height=o+4+"px"}n=e}},y=()=>{const e=["code-annotation-line-highlight","code-annotation-line-highlight-gutter"];e.forEach(e=>{const t=window.document.getElementById(e);t&&t.remove()}),n=0[0]};window.addEventListener("resize",_(()=>{elRect=0[0],n&&a(n)},10));function _(e,t){let s=!1,n;return(...o)=>{s?(n&&clearTimeout(n),n=setTimeout(()=>{e.apply(this,o),n=s=!1},t)):(e.apply(this,o),s=!0)}}const d=window.document.querySelectorAll(".code-annotation-anchor");for(let e=0;e<d.length;e++){const t=d[e],n=t.getAttribute("data-target-cell"),s=t.getAttribute("data-target-annotation"),o=()=>{const e=window.document.querySelector(h(n,s));if(e){const t=e.cloneNode(!0);return t.classList.add("code-annotation-tip-content"),t.outerHTML}},i={allowHTML:!0,content:o,onShow:e=>{a(e.reference),e.reference.classList.add("code-annotation-active"),window.tippy.hideAll()},onHide:e=>{y(),e.reference.classList.remove("code-annotation-active")},maxWidth:300,delay:[50,0],duration:[200,0],offset:[5,10],arrow:!0,appendTo:function(e){return e.parentElement.parentElement.parentElement},interactive:!0,interactiveBorder:10,theme:"quarto",placement:"right",popperOptions:{modifiers:[{name:"flip",options:{flipVariations:!1,allowedAutoPlacements:["right"],fallbackPlacements:["right","top","top-start","top-end","bottom","bottom-start","bottom-end","left"]}},{name:"preventOverflow",options:{mainAxis:!1,altAxis:!1}}]}};window.tippy(t,i)}const l=e=>{const t=e.parentElement;if(t){const n=t.dataset.cites;return n?{el:e,cites:n.split(" ")}:l(e.parentElement)}else return 0[0]};for(s=window.document.querySelectorAll('a[role="doc-biblioref"]'),t=0;t<s.length;t++){const n=s[t],e=l(n);e&&i(e.el,function(){var t=window.document.createElement("div");return e.cites.forEach(function(e){var s,n=window.document.createElement("div");n.classList.add("hanging-indent"),n.classList.add("csl-entry"),s=window.document.getElementById("ref-"+e),s&&(n.innerHTML=s.innerHTML),t.appendChild(n)}),t.innerHTML})}})</script></div><footer class=footer><div class=nav-footer><div class=nav-footer-left><p><img id=footer-cat-left src=../images/cat-left.png alt="Cat Left"></div><div class=nav-footer-center><p><span id=footer-center>Made with ❤️ by Tony, (CC&nbsp;BY&nbsp;4.0)<br><span style=font-size:8px>Cat source: Freepik and ChatGPT</span></span></div><div class=nav-footer-right><p><img id=footer-cat-right src=../images/cat-right.png alt="Cat Right"></div></div></footer>